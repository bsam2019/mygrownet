<script setup lang="ts">
import { ref, computed, watch, nextTick } from 'vue';
import { Head, router } from '@inertiajs/vue3';
import draggable from 'vuedraggable';
import {
    Bars3Icon,
    XMarkIcon,
    PlusIcon,
    EyeIcon,
    DevicePhoneMobileIcon,
    ComputerDesktopIcon,
    ArrowsUpDownIcon,
    DocumentDuplicateIcon,
    TrashIcon,
    ChevronLeftIcon,
    ChevronRightIcon,
    Squares2X2Icon,
    PaintBrushIcon,
    Cog6ToothIcon,
    SparklesIcon,
    PhotoIcon,
    RectangleGroupIcon,
    ChatBubbleBottomCenterTextIcon,
    StarIcon,
    CurrencyDollarIcon,
    EnvelopeIcon,
    MegaphoneIcon,
    DocumentTextIcon,
    CheckBadgeIcon,
    ShoppingBagIcon,
    DocumentIcon,
    ChevronDownIcon,
    ArrowUpIcon,
    ArrowDownIcon,
    PencilIcon,
    CheckIcon,
    LinkIcon,
    Bars3BottomLeftIcon,
    GlobeAltIcon,
    QuestionMarkCircleIcon,
    UserGroupIcon,
    NewspaperIcon,
    ChartBarIcon,
    MapPinIcon,
    PlayCircleIcon,
    MinusIcon,
    HomeIcon,
    BriefcaseIcon,
} from '@heroicons/vue/24/outline';
import axios from 'axios';

interface NavItem {
    id: string;
    label: string;
    url: string;
    pageId?: number;
    isExternal: boolean;
    children: NavItem[];
}

interface Section {
    id: string;
    type: string;
    content: Record<string, any>;
    style: Record<string, any>;
}

interface Page {
    id: number;
    title: string;
    slug: string;
    content: { sections: Section[] };
    isHomepage: boolean;
    isPublished: boolean;
    showInNav: boolean;
    navOrder: number;
}

interface SectionType {
    type: string;
    name: string;
    icon: any;
    category: string;
    description: string;
}

interface Site {
    id: number;
    name: string;
    subdomain: string;
    theme: Record<string, any> | null;
    settings: {
        navigation?: {
            logoText?: string;
            logo?: string;
            navItems?: NavItem[];
            showCta?: boolean;
            ctaText?: string;
            ctaLink?: string;
            sticky?: boolean;
            style?: string;
        };
    } | null;
    status: string;
    url: string;
}

const props = defineProps<{
    site: Site;
    pages: Page[];
    currentPage?: Page;
    sectionTypes: SectionType[];
}>();

// Section type definitions with icons and categories (navigation is site-wide, not a section)
const sectionBlocks: SectionType[] = [
    // Layout
    { type: 'hero', name: 'Hero', icon: SparklesIcon, category: 'Layout', description: 'Eye-catching header section' },
    { type: 'page-header', name: 'Page Header', icon: Bars3Icon, category: 'Layout', description: 'Title banner for inner pages' },
    { type: 'cta', name: 'Call to Action', icon: MegaphoneIcon, category: 'Layout', description: 'Drive conversions' },
    { type: 'divider', name: 'Divider', icon: MinusIcon, category: 'Layout', description: 'Visual separator' },
    // Content
    { type: 'about', name: 'About', icon: DocumentTextIcon, category: 'Content', description: 'Tell your story' },
    { type: 'services', name: 'Services', icon: RectangleGroupIcon, category: 'Content', description: 'Showcase what you offer' },
    { type: 'features', name: 'Features', icon: CheckBadgeIcon, category: 'Content', description: 'Highlight key features' },
    { type: 'team', name: 'Team', icon: UserGroupIcon, category: 'Content', description: 'Meet the team' },
    { type: 'faq', name: 'FAQ', icon: QuestionMarkCircleIcon, category: 'Content', description: 'Frequently asked questions' },
    { type: 'stats', name: 'Stats/Counter', icon: ChartBarIcon, category: 'Content', description: 'Show impressive numbers' },
    { type: 'text', name: 'Text Block', icon: DocumentTextIcon, category: 'Content', description: 'Rich text content' },
    // Media
    { type: 'gallery', name: 'Gallery', icon: PhotoIcon, category: 'Media', description: 'Display images beautifully' },
    { type: 'video', name: 'Video', icon: PlayCircleIcon, category: 'Media', description: 'Embed video content' },
    { type: 'map', name: 'Map', icon: MapPinIcon, category: 'Media', description: 'Show your location' },
    // Social Proof
    { type: 'testimonials', name: 'Testimonials', icon: ChatBubbleBottomCenterTextIcon, category: 'Social Proof', description: 'Customer reviews' },
    { type: 'blog', name: 'Blog Posts', icon: NewspaperIcon, category: 'Social Proof', description: 'Latest articles' },
    // Commerce
    { type: 'pricing', name: 'Pricing', icon: CurrencyDollarIcon, category: 'Commerce', description: 'Pricing plans' },
    { type: 'products', name: 'Products', icon: ShoppingBagIcon, category: 'Commerce', description: 'Product catalog' },
    // Forms
    { type: 'contact', name: 'Contact', icon: EnvelopeIcon, category: 'Forms', description: 'Contact form' },
];

const sectionCategories = ['Layout', 'Content', 'Media', 'Social Proof', 'Commerce', 'Forms'];

// Pre-designed page templates
interface PageTemplate {
    id: string;
    name: string;
    description: string;
    iconType: string; // Icon type identifier
    isHomepage?: boolean;
    sections: Array<{ type: string; content: Record<string, any>; style: Record<string, any> }>;
}

// Helper to get icon component for template
const getTemplateIcon = (iconType: string) => {
    const icons: Record<string, any> = {
        'document': DocumentIcon,
        'home': HomeIcon,
        'sparkles': SparklesIcon,
        'briefcase': BriefcaseIcon,
        'users': UserGroupIcon,
        'cog': Cog6ToothIcon,
        'envelope': EnvelopeIcon,
        'question': QuestionMarkCircleIcon,
        'currency': CurrencyDollarIcon,
        'newspaper': NewspaperIcon,
        'photo': PhotoIcon,
        'star': StarIcon,
    };
    return icons[iconType] || DocumentIcon;
};

const pageTemplates: PageTemplate[] = [
    {
        id: 'blank',
        name: 'Blank Page',
        description: 'Start from scratch with a clean canvas',
        iconType: 'document',
        sections: [],
    },
    {
        id: 'home',
        name: 'Home Page',
        description: 'Premium landing page with hero, services, and social proof',
        iconType: 'home',
        isHomepage: true,
        sections: [
            {
                type: 'hero',
                content: {
                    title: 'Build Something Extraordinary',
                    subtitle: 'We partner with ambitious businesses to create digital experiences that captivate audiences, drive growth, and deliver measurable results.',
                    buttonText: 'Start Your Project',
                    buttonLink: '#contact',
                    secondaryButtonText: 'View Our Work',
                    secondaryButtonLink: '#portfolio',
                    textPosition: 'center',
                    backgroundImage: '',
                },
                style: { minHeight: 600, backgroundColor: '#0a0a0a' },
            },
            {
                type: 'stats',
                content: {
                    title: 'Trusted by Leading Brands',
                    items: [
                        { value: '500+', label: 'Projects Delivered' },
                        { value: '98%', label: 'Client Satisfaction' },
                        { value: 'K50M+', label: 'Revenue Generated' },
                        { value: '24/7', label: 'Support Available' },
                    ],
                },
                style: { backgroundColor: '#ffffff' },
            },
            {
                type: 'services',
                content: {
                    title: 'Solutions That Drive Results',
                    subtitle: 'Comprehensive services tailored to your unique business needs',
                    items: [
                        { title: 'Strategic Consulting', description: 'Data-driven strategies that align your vision with market opportunities for sustainable competitive advantage.', icon: 'chart' },
                        { title: 'Digital Transformation', description: 'End-to-end modernization of your technology stack, processes, and customer experiences.', icon: 'code' },
                        { title: 'Brand Development', description: 'Compelling brand identities that resonate with your audience and differentiate you in the market.', icon: 'sparkles' },
                    ],
                },
                style: { backgroundColor: '#fafafa' },
            },
            {
                type: 'about',
                content: {
                    title: 'Why Choose Us?',
                    description: 'For over a decade, we\'ve helped businesses across Zambia and beyond transform their operations and achieve breakthrough results. Our approach combines deep industry expertise with innovative thinking, ensuring every solution is tailored to your specific goals. We don\'t just deliver projects—we build lasting partnerships.',
                    image: '',
                    imagePosition: 'right',
                    features: ['Proven track record with 500+ successful projects', 'Dedicated team of certified professionals', 'Transparent pricing with no hidden fees', 'Ongoing support and optimization'],
                },
                style: { backgroundColor: '#ffffff' },
            },
            {
                type: 'testimonials',
                content: {
                    title: 'What Our Clients Say',
                    subtitle: 'Don\'t just take our word for it',
                    items: [
                        { name: 'Chanda Mwila', text: 'Working with this team transformed our entire digital presence. We saw a 300% increase in online leads within the first quarter. Their strategic approach is unmatched.', role: 'CEO, Mwila Technologies', image: '', rating: 5 },
                        { name: 'Grace Banda', text: 'The professionalism and attention to detail exceeded all expectations. They truly understood our vision and delivered beyond what we imagined possible.', role: 'Founder, Banda Ventures', image: '', rating: 5 },
                        { name: 'Dr. James Phiri', text: 'From strategy to execution, every step was handled with excellence. Our revenue has doubled since implementing their recommendations.', role: 'Director, Phiri Healthcare Group', image: '', rating: 5 },
                    ],
                },
                style: { backgroundColor: '#f8fafc' },
            },
            {
                type: 'cta',
                content: {
                    title: 'Ready to Transform Your Business?',
                    description: 'Book a free 30-minute strategy session and discover how we can help you achieve your goals.',
                    buttonText: 'Schedule Free Consultation',
                    buttonLink: '#contact',
                },
                style: { backgroundColor: '#1e3a8a' },
            },
            {
                type: 'contact',
                content: {
                    title: 'Let\'s Start a Conversation',
                    description: 'Tell us about your project. Our team responds within 24 hours.',
                    showForm: true,
                    email: 'hello@yourbusiness.com',
                    phone: '+260 97X XXX XXX',
                    address: 'Cairo Road, Lusaka, Zambia',
                },
                style: { backgroundColor: '#ffffff' },
            },
        ],
    },
    {
        id: 'home-minimal',
        name: 'Minimal Home',
        description: 'Clean, elegant design with focused messaging',
        iconType: 'sparkles',
        isHomepage: true,
        sections: [
            {
                type: 'hero',
                content: {
                    title: 'Less Noise. More Impact.',
                    subtitle: 'We help forward-thinking brands cut through the clutter with elegant solutions that simply work.',
                    buttonText: 'Let\'s Talk',
                    buttonLink: '#contact',
                    textPosition: 'center',
                    backgroundImage: '',
                },
                style: { minHeight: 550, backgroundColor: '#111111' },
            },
            {
                type: 'features',
                content: {
                    title: 'Our Philosophy',
                    subtitle: 'Simple principles that guide everything we do',
                    items: [
                        { title: 'Clarity', description: 'We strip away complexity to reveal what truly matters for your business.', icon: 'eye' },
                        { title: 'Craft', description: 'Every detail is considered. Every pixel has purpose.', icon: 'sparkles' },
                        { title: 'Results', description: 'Beautiful design means nothing without measurable outcomes.', icon: 'chart' },
                        { title: 'Partnership', description: 'Your success is our success. We\'re in this together.', icon: 'users' },
                    ],
                },
                style: { backgroundColor: '#ffffff' },
            },
            {
                type: 'about',
                content: {
                    title: 'Thoughtful Design. Tangible Results.',
                    description: 'We believe the best solutions are elegantly simple. Our team combines strategic thinking with meticulous execution to create experiences that resonate with your audience and drive real business growth.',
                    image: '',
                    imagePosition: 'left',
                },
                style: { backgroundColor: '#fafafa' },
            },
            {
                type: 'cta',
                content: {
                    title: 'Ready to Simplify?',
                    description: 'Let\'s create something remarkable together.',
                    buttonText: 'Start a Project',
                    buttonLink: '#contact',
                },
                style: { backgroundColor: '#0a0a0a' },
            },
        ],
    },
    {
        id: 'home-business',
        name: 'Business Home',
        description: 'Professional corporate landing page',
        iconType: 'briefcase',
        isHomepage: true,
        sections: [
            {
                type: 'hero',
                content: {
                    title: 'Empowering Zambian Businesses to Compete Globally',
                    subtitle: 'Strategic consulting, digital solutions, and operational excellence for organizations ready to scale.',
                    buttonText: 'Request Proposal',
                    buttonLink: '#contact',
                    secondaryButtonText: 'Our Services',
                    secondaryButtonLink: '#services',
                    textPosition: 'left',
                    backgroundImage: '',
                },
                style: { minHeight: 580, backgroundColor: '#0c2340' },
            },
            {
                type: 'stats',
                content: {
                    title: '',
                    items: [
                        { value: 'K75M+', label: 'Client Revenue Generated' },
                        { value: '200+', label: 'Enterprise Clients' },
                        { value: '15+', label: 'Years in Business' },
                        { value: '99.9%', label: 'Project Success Rate' },
                    ],
                },
                style: { backgroundColor: '#ffffff' },
            },
            {
                type: 'services',
                content: {
                    title: 'Enterprise Solutions',
                    subtitle: 'Comprehensive services for growing organizations',
                    items: [
                        { title: 'Executive Advisory', description: 'C-suite consulting that aligns strategy with execution. We help leadership teams make confident decisions backed by data and experience.', icon: 'briefcase' },
                        { title: 'Digital Transformation', description: 'Modernize your technology infrastructure, automate processes, and create seamless digital experiences for customers and employees.', icon: 'code' },
                        { title: 'Market Expansion', description: 'Research-driven strategies to enter new markets, launch products, and capture growth opportunities across Africa and beyond.', icon: 'globe' },
                        { title: 'Operational Excellence', description: 'Lean methodologies and process optimization that reduce costs, improve quality, and accelerate delivery.', icon: 'cog' },
                        { title: 'Talent & Culture', description: 'Leadership development, team training, and organizational design that builds high-performance cultures.', icon: 'users' },
                        { title: 'Risk & Compliance', description: 'Comprehensive frameworks to identify, assess, and mitigate business risks while ensuring regulatory compliance.', icon: 'shield' },
                    ],
                },
                style: { backgroundColor: '#f8fafc' },
            },
            {
                type: 'testimonials',
                content: {
                    title: 'Trusted by Industry Leaders',
                    items: [
                        { name: 'Jonathan Mwale', text: 'Their strategic guidance was instrumental in our expansion. We grew from 50 to 200 employees and tripled revenue in just two years.', role: 'Managing Director, Mwale Holdings', image: '', rating: 5 },
                        { name: 'Patricia Tembo', text: 'The digital transformation they delivered has completely changed how we operate. Efficiency is up 40% and customer satisfaction has never been higher.', role: 'COO, Tembo Financial Services', image: '', rating: 5 },
                        { name: 'Robert Sakala', text: 'Professional, thorough, and genuinely invested in our success. They\'ve become an extension of our leadership team.', role: 'CEO, Sakala Industries', image: '', rating: 5 },
                    ],
                },
                style: { backgroundColor: '#ffffff' },
            },
            {
                type: 'features',
                content: {
                    title: 'The Advantage',
                    subtitle: 'Why leading organizations choose us',
                    items: [
                        { title: 'Proven Methodology', description: 'Battle-tested frameworks refined through 500+ successful engagements.' },
                        { title: 'Senior Expertise', description: 'Work directly with experienced consultants, not junior staff.' },
                        { title: 'Measurable ROI', description: 'Clear KPIs and regular reporting so you always know the impact.' },
                        { title: 'Local & Global', description: 'Deep Zambian market knowledge combined with international best practices.' },
                    ],
                },
                style: { backgroundColor: '#f8fafc' },
            },
            {
                type: 'cta',
                content: {
                    title: 'Let\'s Discuss Your Growth Strategy',
                    description: 'Schedule a confidential executive briefing with our senior team.',
                    buttonText: 'Book Executive Briefing',
                    buttonLink: '#contact',
                },
                style: { backgroundColor: '#0c2340' },
            },
        ],
    },
    {
        id: 'about',
        name: 'About Us',
        description: 'Company story, mission, and team showcase',
        iconType: 'users',
        sections: [
            { type: 'page-header', content: { title: 'Our Story', subtitle: 'Building tomorrow\'s solutions with today\'s passion', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'about', content: { title: 'A Legacy of Excellence', description: 'Founded on the belief that every business deserves access to world-class expertise, we have spent over a decade helping organizations transform challenges into opportunities. Our journey began with a simple mission: to be the partner that businesses can truly rely on. Today, we serve clients across diverse industries, from ambitious startups to established enterprises.', image: '', imagePosition: 'right' }, style: { backgroundColor: '#ffffff' } },
            { type: 'features', content: { title: 'Our Core Values', items: [{ title: 'Excellence', description: 'We pursue the highest standards in everything we do, never settling for mediocrity.' }, { title: 'Integrity', description: 'Honesty and transparency form the foundation of every relationship we build.' }, { title: 'Innovation', description: 'We embrace change and continuously seek better ways to serve our clients.' }, { title: 'Impact', description: 'We measure success by the tangible difference we make in our clients\' lives.' }] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'stats', content: { title: 'Our Impact in Numbers', items: [{ value: '15+', label: 'Years of Service' }, { value: '500+', label: 'Success Stories' }, { value: '50+', label: 'Expert Team Members' }, { value: '12', label: 'Countries Served' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'team', content: { title: 'Meet the Leadership', items: [{ name: 'David Mulenga', role: 'Founder & CEO', image: '', bio: 'Visionary entrepreneur with 20+ years building successful ventures across Africa.' }, { name: 'Chipo Banda', role: 'Chief Operations Officer', image: '', bio: 'Operations expert who has streamlined processes for Fortune 500 companies.' }, { name: 'Emmanuel Phiri', role: 'Head of Innovation', image: '', bio: 'Technology leader passionate about leveraging digital solutions for growth.' }] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'cta', content: { title: 'Become Part of Our Story', description: 'Let\'s write the next chapter together', buttonText: 'Start the Conversation', buttonLink: '/contact' }, style: { backgroundColor: '#1e40af' } },
        ],
    },
    {
        id: 'services',
        name: 'Services',
        description: 'Detailed service offerings and benefits',
        iconType: 'cog',
        sections: [
            { type: 'page-header', content: { title: 'Our Services', subtitle: 'Tailored solutions designed to accelerate your success', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'services', content: { title: 'What We Offer', items: [{ title: 'Strategic Advisory', description: 'Expert guidance on business strategy, market positioning, and growth planning backed by data-driven insights.' }, { title: 'Digital Solutions', description: 'Custom software development, system integration, and digital transformation services for the modern enterprise.' }, { title: 'Brand & Marketing', description: 'Comprehensive branding, digital marketing, and communication strategies that connect with your audience.' }, { title: 'Training & Development', description: 'Professional development programs, workshops, and coaching to elevate your team\'s capabilities.' }, { title: 'Financial Consulting', description: 'Financial planning, analysis, and advisory services to optimize your business performance.' }, { title: 'Project Management', description: 'End-to-end project delivery with proven methodologies ensuring on-time, on-budget results.' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'features', content: { title: 'The Advantage of Working With Us', items: [{ title: 'Proven Methodology', description: 'Battle-tested frameworks refined through hundreds of successful engagements.' }, { title: 'Dedicated Teams', description: 'Senior professionals assigned to your project from start to finish.' }, { title: 'Measurable Results', description: 'Clear KPIs and regular reporting so you always know the impact.' }, { title: 'Ongoing Support', description: 'Long-term partnership with continuous optimization and support.' }] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'cta', content: { title: 'Ready to Get Started?', description: 'Let\'s discuss how our services can address your specific needs', buttonText: 'Request a Custom Proposal', buttonLink: '/contact' }, style: { backgroundColor: '#1e40af' } },
        ],
    },
    {
        id: 'contact',
        name: 'Contact',
        description: 'Professional contact page with form and details',
        iconType: 'envelope',
        sections: [
            { type: 'page-header', content: { title: 'Get in Touch', subtitle: 'We\'re here to help you succeed', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'contact', content: { title: 'Send Us a Message', description: 'Fill out the form below and a member of our team will respond within 24 hours. We look forward to learning about your goals.', showForm: true, email: 'hello@yourbusiness.com', phone: '+260 97X XXX XXX', address: 'Plot 123, Cairo Road, Lusaka, Zambia' }, style: { backgroundColor: '#ffffff' } },
            { type: 'features', content: { title: 'Why Reach Out?', items: [{ title: 'Free Consultation', description: 'No obligation discussion about your needs and how we can help.' }, { title: 'Quick Response', description: 'Our team responds to all inquiries within 24 business hours.' }, { title: 'Expert Guidance', description: 'Speak directly with specialists who understand your industry.' }, { title: 'Flexible Options', description: 'Solutions tailored to your budget and timeline.' }] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'map', content: { title: 'Visit Our Office', address: 'Plot 123, Cairo Road, Lusaka, Zambia', embedUrl: '', showAddress: true }, style: { backgroundColor: '#ffffff' } },
        ],
    },
    {
        id: 'faq',
        name: 'FAQ',
        description: 'Comprehensive frequently asked questions',
        iconType: 'question',
        sections: [
            { type: 'page-header', content: { title: 'Frequently Asked Questions', subtitle: 'Everything you need to know about working with us', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'faq', content: { title: 'General Questions', items: [{ question: 'What industries do you serve?', answer: 'We work with clients across diverse sectors including technology, finance, healthcare, manufacturing, retail, and professional services. Our methodologies are adaptable to any industry.' }, { question: 'How do you ensure project success?', answer: 'Every engagement begins with a thorough discovery phase. We use proven project management methodologies, maintain transparent communication, and provide regular progress updates. Our success rate is 98%.' }, { question: 'What is your typical engagement process?', answer: '1) Initial consultation, 2) Proposal with detailed scope, 3) Kick-off and discovery, 4) Iterative development with check-ins, 5) Delivery and knowledge transfer, 6) Ongoing support.' }, { question: 'Do you offer ongoing support?', answer: 'Absolutely. We offer various support packages including maintenance, optimization, training, and strategic advisory services to ensure continued success.' }, { question: 'How do you handle confidentiality?', answer: 'We take confidentiality extremely seriously. All team members sign NDAs, and we implement strict data security protocols with enterprise-grade measures.' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'cta', content: { title: 'Still Have Questions?', description: 'Our team is happy to provide personalized answers', buttonText: 'Contact Our Team', buttonLink: '/contact' }, style: { backgroundColor: '#1e40af' } },
        ],
    },
    {
        id: 'pricing',
        name: 'Pricing',
        description: 'Clear pricing plans and packages',
        iconType: 'currency',
        sections: [
            { type: 'page-header', content: { title: 'Simple, Transparent Pricing', subtitle: 'Choose the plan that fits your needs. No hidden fees.', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'pricing', content: { title: 'Our Plans', plans: [{ name: 'Starter', price: 'K2,500/mo', features: ['Up to 5 team members', 'Core platform features', 'Email support (48hr)', 'Monthly reports', 'Basic analytics'] }, { name: 'Professional', price: 'K7,500/mo', features: ['Up to 25 team members', 'All Starter features', 'Priority support (24hr)', 'Weekly strategy calls', 'Advanced analytics', 'Custom integrations'] }, { name: 'Enterprise', price: 'Custom', features: ['Unlimited team members', 'All Professional features', '24/7 premium support', 'On-site consultations', 'Custom development', 'SLA guarantees'] }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'features', content: { title: 'All Plans Include', items: [{ title: 'No Long-Term Contracts', description: 'Month-to-month flexibility. Stay because you want to.' }, { title: 'Free Onboarding', description: 'Personalized setup and training at no extra cost.' }, { title: 'Regular Updates', description: 'Continuous improvements included in your subscription.' }, { title: 'Data Security', description: 'Enterprise-grade security and compliance.' }] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'faq', content: { title: 'Pricing FAQ', items: [{ question: 'Can I switch plans anytime?', answer: 'Yes! Upgrade or downgrade at any time. Changes take effect on your next billing cycle.' }, { question: 'Is there a free trial?', answer: 'We offer a 14-day free trial on Starter and Professional plans. No credit card required.' }, { question: 'What payment methods do you accept?', answer: 'MTN Mobile Money, Airtel Money, bank transfers, Visa, and Mastercard.' }, { question: 'Do you offer annual discounts?', answer: 'Yes! Save 20% when you choose annual billing.' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'cta', content: { title: 'Need a Custom Solution?', description: 'Let\'s design a package tailored to your requirements', buttonText: 'Talk to Sales', buttonLink: '/contact' }, style: { backgroundColor: '#1e40af' } },
        ],
    },
    {
        id: 'blog',
        name: 'Blog/News',
        description: 'Latest insights and company updates',
        iconType: 'newspaper',
        sections: [
            { type: 'page-header', content: { title: 'Insights & News', subtitle: 'Thought leadership, industry trends, and company updates', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'blog', content: { title: 'Latest Articles', showLatest: true, limit: 6, posts: [{ title: 'The Future of Digital Transformation in Africa', excerpt: 'Exploring how African businesses are leveraging technology to compete on the global stage.', date: new Date().toISOString().split('T')[0], image: '' }, { title: '5 Strategies for Sustainable Business Growth', excerpt: 'Proven approaches that successful companies use to scale while maintaining quality.', date: new Date().toISOString().split('T')[0], image: '' }, { title: 'Building High-Performance Teams', excerpt: 'Insights from our experience helping organizations develop teams that exceed expectations.', date: new Date().toISOString().split('T')[0], image: '' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'cta', content: { title: 'Stay Informed', description: 'Subscribe to our newsletter for weekly insights', buttonText: 'Subscribe Now', buttonLink: '#subscribe' }, style: { backgroundColor: '#f8fafc' } },
        ],
    },
    {
        id: 'gallery',
        name: 'Gallery/Portfolio',
        description: 'Showcase your best work and projects',
        iconType: 'photo',
        sections: [
            { type: 'page-header', content: { title: 'Our Portfolio', subtitle: 'A showcase of projects we\'re proud to have delivered', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'about', content: { title: 'Excellence in Every Project', description: 'Each project represents a unique challenge met with creativity, expertise, and dedication. From startups to enterprises, we bring the same level of commitment to every engagement.', image: '', imagePosition: 'left' }, style: { backgroundColor: '#ffffff' } },
            { type: 'gallery', content: { title: 'Featured Projects', images: [] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'testimonials', content: { title: 'Client Feedback', items: [{ name: 'Natasha Mwanza', text: 'The attention to detail was extraordinary. They captured our vision perfectly.', role: 'Marketing Director, Mwanza Group' }, { name: 'Joseph Lungu', text: 'Professional, creative, and incredibly responsive. A pleasure to work with.', role: 'Founder, Lungu Innovations' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'cta', content: { title: 'Ready to Create Something Amazing?', description: 'Let\'s discuss your project and bring your vision to life', buttonText: 'Start Your Project', buttonLink: '/contact' }, style: { backgroundColor: '#1e40af' } },
        ],
    },
    {
        id: 'testimonials',
        name: 'Testimonials',
        description: 'Customer success stories and reviews',
        iconType: 'star',
        sections: [
            { type: 'page-header', content: { title: 'Client Success Stories', subtitle: 'Hear from the businesses we\'ve helped transform', backgroundColor: '#0f172a', textColor: '#ffffff', textPosition: 'center' }, style: { minHeight: 220 } },
            { type: 'about', content: { title: 'Our Clients\' Success Is Our Greatest Achievement', description: 'We measure our success not by the projects we complete, but by the lasting impact we create. Every testimonial represents a relationship built on trust and results that speak for themselves.', image: '', imagePosition: 'right' }, style: { backgroundColor: '#ffffff' } },
            { type: 'testimonials', content: { title: 'What Our Clients Say', items: [{ name: 'Catherine Mumba', text: 'Partnering with this team was a game-changer. Their strategic insights helped us expand into two new markets and increase revenue by 180%.', role: 'CEO, Mumba Holdings' }, { name: 'Richard Sakala', text: 'The level of professionalism is unmatched. They took time to understand our business before proposing solutions.', role: 'Managing Director, Sakala Technologies' }, { name: 'Florence Tembo', text: 'What impressed me most was their commitment to our success. They became trusted advisors who genuinely cared.', role: 'Founder, Tembo Consulting' }, { name: 'Michael Zulu', text: 'From consultation to delivery, every interaction was marked by excellence. Truly world-class.', role: 'Operations Director, Zulu Enterprises' }] }, style: { backgroundColor: '#f8fafc' } },
            { type: 'stats', content: { title: 'The Numbers Speak', items: [{ value: '98%', label: 'Client Satisfaction' }, { value: '500+', label: 'Projects Completed' }, { value: '150%', label: 'Average ROI' }, { value: '95%', label: 'Client Retention' }] }, style: { backgroundColor: '#ffffff' } },
            { type: 'cta', content: { title: 'Join Our Success Stories', description: 'Become our next satisfied client', buttonText: 'Get Started Today', buttonLink: '/contact' }, style: { backgroundColor: '#1e40af' } },
        ],
    },
];

// UI State
const leftSidebarOpen = ref(true);
const rightSidebarOpen = ref(true);
const previewMode = ref<'desktop' | 'mobile'>('desktop');
const selectedSectionId = ref<string | null>(null);
const saving = ref(false);
const isDragging = ref(false);
const activeInspectorTab = ref<'content' | 'style' | 'advanced'>('content');
const showAddSectionPanel = ref(false);
const pagesExpanded = ref(true);
const hoveredSectionId = ref<string | null>(null);
const activeLeftTab = ref<'pages' | 'widgets'>('widgets');
const widgetCategoryExpanded = ref<Record<string, boolean>>({
    'Layout': true,
    'Content': true,
    'Media': false,
    'Social Proof': false,
    'Commerce': false,
    'Forms': false,
});

// Page Management State
const showCreatePageModal = ref(false);
const showEditPageModal = ref(false);
const editingPage = ref<Page | null>(null);
const newPageForm = ref({ title: '', slug: '', showInNav: true, templateId: 'blank' });
const creatingPage = ref(false);
const pageError = ref<string | null>(null);
const createPageStep = ref<'template' | 'details'>('template');

// Apply Template State
const showApplyTemplateModal = ref(false);
const applyingTemplate = ref(false);

// Navigation Editor State
const showNavEditor = ref(false);
const navItems = ref<NavItem[]>([]);
const editingNavItem = ref<NavItem | null>(null);
const showNavItemModal = ref(false);
const navItemForm = ref({ label: '', url: '', pageId: null as number | null, isExternal: false });

// Site Navigation (appears on all pages)
const siteNavigation = ref({
    logoText: props.site.name,
    logo: '',
    navItems: [] as NavItem[],
    showCta: true,
    ctaText: 'Contact Us',
    ctaLink: '#contact',
    sticky: true,
    style: 'default' as 'default' | 'centered' | 'split' | 'floating' | 'transparent' | 'dark' | 'sidebar' | 'mega',
});

// Navigation style options
const navStyleOptions = [
    { id: 'default', name: 'Default', description: 'Clean & simple layout' },
    { id: 'centered', name: 'Centered', description: 'Logo in the middle' },
    { id: 'split', name: 'Split', description: 'Links on both sides of logo' },
    { id: 'floating', name: 'Floating', description: 'Rounded with shadow' },
    { id: 'transparent', name: 'Transparent', description: 'Overlay on hero' },
    { id: 'dark', name: 'Dark', description: 'Dark background' },
    { id: 'sidebar', name: 'Sidebar', description: 'Hamburger menu' },
    { id: 'mega', name: 'Mega Menu', description: 'Dropdown columns' },
];

const showNavSettings = ref(false);
const selectedNavItemIndex = ref<number | null>(null);

// Site Footer (appears on all pages)
interface FooterLink {
    id: string;
    label: string;
    url: string;
}

interface SocialLink {
    id: string;
    platform: 'facebook' | 'twitter' | 'instagram' | 'linkedin' | 'youtube' | 'tiktok';
    url: string;
}

const siteFooter = ref({
    logo: '',
    copyrightText: `© ${new Date().getFullYear()} ${props.site.name}. All rights reserved.`,
    showSocialLinks: true,
    socialLinks: [] as SocialLink[],
    columns: [
        { id: 'col-1', title: 'Quick Links', links: [] as FooterLink[] },
        { id: 'col-2', title: 'Contact', links: [] as FooterLink[] },
    ],
    showNewsletter: false,
    newsletterTitle: 'Subscribe to our newsletter',
    backgroundColor: '#1f2937',
    textColor: '#ffffff',
    layout: 'columns' as 'columns' | 'centered' | 'split' | 'minimal' | 'stacked' | 'newsletter' | 'social' | 'contact',
});

const showFooterSettings = ref(false);

// Image Upload State
const uploadingImage = ref(false);
const imageUploadError = ref<string | null>(null);
const mediaLibrary = ref<any[]>([]);
const showMediaLibrary = ref(false);
const mediaLibraryTarget = ref<{
    sectionId?: string;
    field: string;
    itemIndex?: number;
    target?: 'navigation' | 'footer' | 'section';
} | null>(null);

// Inline Editing State
const editingField = ref<{ sectionId: string; field: string; itemIndex?: number } | null>(null);
const editingValue = ref<string>('');

// Section Resize State
const resizingSection = ref<string | null>(null);
const resizeStartY = ref(0);
const resizeStartHeight = ref(0);

// Element Drag Positioning State
const draggingElement = ref<{ sectionId: string; elementKey: string } | null>(null);
const dragStartPos = ref({ x: 0, y: 0 });
const dragStartElementPos = ref({ x: 0, y: 0 });
const elementPositionMode = ref<'preset' | 'custom'>('preset'); // preset uses textPosition, custom uses x/y coordinates

// Page State
const activePage = ref<Page | null>(props.currentPage || props.pages[0] || null);
const sections = ref<Section[]>([]);
const pageTitle = ref('');

// Initialize sections with IDs
const initializeSections = () => {
    if (activePage.value?.content?.sections) {
        sections.value = activePage.value.content.sections.map((s, i) => ({
            ...s,
            id: s.id || `section-${Date.now()}-${i}`,
            style: s.style || {},
        }));
    } else {
        sections.value = [];
    }
    pageTitle.value = activePage.value?.title || 'New Page';
};

// Initialize site-wide navigation from site settings or pages
const initializeSiteNavigation = () => {
    // Load from site settings if available
    if (props.site.settings?.navigation) {
        siteNavigation.value = {
            ...siteNavigation.value,
            ...props.site.settings.navigation,
        };
    } else {
        // Build from pages that should show in nav
        siteNavigation.value.navItems = props.pages
            .filter(p => p.showInNav)
            .sort((a, b) => a.navOrder - b.navOrder)
            .map(p => ({
                id: `nav-${p.id}`,
                label: p.title,
                url: p.isHomepage ? '/' : `/${p.slug}`,
                pageId: p.id,
                isExternal: false,
                children: [],
            }));
    }
};

// Initialize site-wide footer from site settings
const initializeSiteFooter = () => {
    if (props.site.settings?.footer) {
        siteFooter.value = {
            ...siteFooter.value,
            ...props.site.settings.footer,
        };
    }
};

// Initialize navigation from pages (legacy, for navItems ref)
const initializeNavigation = () => {
    navItems.value = props.pages
        .filter(p => p.showInNav)
        .sort((a, b) => a.navOrder - b.navOrder)
        .map(p => ({
            id: `nav-${p.id}`,
            label: p.title,
            url: p.isHomepage ? '/' : `/${p.slug}`,
            pageId: p.id,
            isExternal: false,
            children: [],
        }));
};

initializeSections();
initializeSiteNavigation();
initializeSiteFooter();
initializeNavigation();

watch(() => props.currentPage, (newPage) => {
    if (newPage) {
        activePage.value = newPage;
        initializeSections();
        selectedSectionId.value = null;
    }
});

watch(() => props.pages, () => {
    initializeNavigation();
    // Update site navigation items when pages change
    if (!props.site.settings?.navigation) {
        initializeSiteNavigation();
    }
}, { deep: true });

// Computed
const selectedSection = computed(() => {
    if (!selectedSectionId.value) return null;
    return sections.value.find(s => s.id === selectedSectionId.value) || null;
});

const selectedSectionType = computed(() => {
    if (!selectedSection.value) return null;
    return sectionBlocks.find(b => b.type === selectedSection.value?.type) || null;
});

const canvasWidth = computed(() => previewMode.value === 'mobile' ? 'max-w-sm' : 'max-w-4xl');

// Mobile preview responsive helpers
const isMobilePreview = computed(() => previewMode.value === 'mobile');
const gridCols2 = computed(() => isMobilePreview.value ? 'grid-cols-1' : 'grid-cols-1 md:grid-cols-2');
const gridCols3 = computed(() => isMobilePreview.value ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3');
const gridCols4 = computed(() => isMobilePreview.value ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4');
const flexColRow = computed(() => isMobilePreview.value ? 'flex-col' : 'flex-col md:flex-row');
const textSize = computed(() => isMobilePreview.value ? { h1: 'text-2xl', h2: 'text-xl', h3: 'text-lg', p: 'text-sm' } : { h1: 'text-4xl', h2: 'text-3xl', h3: 'text-xl', p: 'text-base' });
const spacing = computed(() => isMobilePreview.value ? { section: 'py-10 px-4', gap: 'gap-4' } : { section: 'py-16 px-8', gap: 'gap-6' });

const pagesForNav = computed(() => props.pages.filter(p => p.isPublished || p.id === activePage.value?.id));

// Section Actions
const selectSection = (id: string) => {
    selectedSectionId.value = id;
    rightSidebarOpen.value = true;
    activeInspectorTab.value = 'content';
};

const addSection = (type: string) => {
    const newSection: Section = {
        id: `section-${Date.now()}`,
        type,
        content: getDefaultContent(type),
        style: { backgroundColor: '#ffffff', textColor: '#111827' },
    };
    sections.value.push(newSection);
    selectedSectionId.value = newSection.id;
    showAddSectionPanel.value = false;
};

const duplicateSection = (id: string) => {
    const index = sections.value.findIndex(s => s.id === id);
    if (index === -1) return;
    const original = sections.value[index];
    const duplicate: Section = {
        ...JSON.parse(JSON.stringify(original)),
        id: `section-${Date.now()}`,
    };
    sections.value.splice(index + 1, 0, duplicate);
    selectedSectionId.value = duplicate.id;
};

const deleteSection = (id: string) => {
    const index = sections.value.findIndex(s => s.id === id);
    if (index === -1) return;
    sections.value.splice(index, 1);
    if (selectedSectionId.value === id) {
        selectedSectionId.value = null;
    }
};

const moveSection = (id: string, direction: 'up' | 'down') => {
    const index = sections.value.findIndex(s => s.id === id);
    if (index === -1) return;
    const newIndex = direction === 'up' ? index - 1 : index + 1;
    if (newIndex < 0 || newIndex >= sections.value.length) return;
    const [section] = sections.value.splice(index, 1);
    sections.value.splice(newIndex, 0, section);
};

// Section Resize Functions
const startResize = (e: MouseEvent, sectionId: string) => {
    e.preventDefault();
    e.stopPropagation();
    resizingSection.value = sectionId;
    resizeStartY.value = e.clientY;
    
    const section = sections.value.find(s => s.id === sectionId);
    const sectionEl = document.querySelector(`[data-section-id="${sectionId}"]`) as HTMLElement;
    resizeStartHeight.value = section?.style?.minHeight || sectionEl?.offsetHeight || 200;
    
    document.addEventListener('mousemove', handleResize);
    document.addEventListener('mouseup', stopResize);
    document.body.style.cursor = 'ns-resize';
    document.body.style.userSelect = 'none';
};

const handleResize = (e: MouseEvent) => {
    if (!resizingSection.value) return;
    
    const deltaY = e.clientY - resizeStartY.value;
    const newHeight = Math.max(100, resizeStartHeight.value + deltaY);
    
    const section = sections.value.find(s => s.id === resizingSection.value);
    if (section) {
        if (!section.style) section.style = {};
        section.style.minHeight = newHeight;
    }
};

const stopResize = () => {
    resizingSection.value = null;
    document.removeEventListener('mousemove', handleResize);
    document.removeEventListener('mouseup', stopResize);
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
};

// Element Drag Positioning Functions
// Uses CSS transform to offset elements from their natural flexbox position
// No mode switching - drag works seamlessly within the existing layout

const startElementDrag = (e: MouseEvent, sectionId: string, elementKey: string) => {
    e.preventDefault();
    e.stopPropagation();
    
    const section = sections.value.find(s => s.id === sectionId);
    if (!section) return;
    
    // Initialize element offsets if not exists
    if (!section.content.elementOffsets) {
        section.content.elementOffsets = {};
    }
    
    // Get current offset or default to 0
    const currentOffset = section.content.elementOffsets[elementKey] || { x: 0, y: 0 };
    
    draggingElement.value = { sectionId, elementKey };
    dragStartPos.value = { x: e.clientX, y: e.clientY };
    dragStartElementPos.value = { x: currentOffset.x, y: currentOffset.y };
    
    document.addEventListener('mousemove', handleElementDrag);
    document.addEventListener('mouseup', stopElementDrag);
    document.body.style.cursor = 'grabbing';
    document.body.style.userSelect = 'none';
};

const handleElementDrag = (e: MouseEvent) => {
    if (!draggingElement.value) return;
    
    const section = sections.value.find(s => s.id === draggingElement.value?.sectionId);
    if (!section) return;
    
    // Calculate delta in pixels - ONLY vertical movement (Y axis)
    const deltaY = e.clientY - dragStartPos.value.y;
    
    // Update element offset (only Y, X stays at 0)
    if (!section.content.elementOffsets) {
        section.content.elementOffsets = {};
    }
    section.content.elementOffsets[draggingElement.value.elementKey] = { 
        x: 0,  // No horizontal movement
        y: dragStartElementPos.value.y + deltaY 
    };
};

const stopElementDrag = () => {
    draggingElement.value = null;
    document.removeEventListener('mousemove', handleElementDrag);
    document.removeEventListener('mouseup', stopElementDrag);
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
};

// Handle section click - only select if not dragging
const handleSectionClick = (e: MouseEvent, sectionId: string) => {
    // Don't select section if we were just dragging an element
    if (draggingElement.value || draggingSectionContent.value) return;
    selectSection(sectionId);
    showNavSettings.value = false;
};

// Get transform style for an element based on its offset (vertical only)
const getElementTransform = (section: Section, elementKey: string): string => {
    const offset = section.content?.elementOffsets?.[elementKey];
    if (!offset || offset.y === 0) {
        return '';
    }
    return `translateY(${offset.y}px)`;
};

// Check if element has been moved from its original position
const hasElementOffset = (section: Section, elementKey: string): boolean => {
    const offset = section.content?.elementOffsets?.[elementKey];
    return offset && offset.y !== 0;
};

// Reset a single element's position
const resetElementOffset = (sectionId: string, elementKey: string) => {
    const section = sections.value.find(s => s.id === sectionId);
    if (!section || !section.content.elementOffsets) return;
    section.content.elementOffsets[elementKey] = { x: 0, y: 0 };
};

// Reset all element positions in a section
const resetAllElementOffsets = (sectionId: string) => {
    const section = sections.value.find(s => s.id === sectionId);
    if (!section) return;
    section.content.elementOffsets = {};
};

// ============================================
// Section Content Drag (for ALL section types)
// Allows dragging the entire content block vertically
// ============================================
const draggingSectionContent = ref<string | null>(null);
const sectionContentDragStart = ref({ y: 0 });
const sectionContentOffsetStart = ref(0);

const startSectionContentDrag = (e: MouseEvent, sectionId: string) => {
    e.preventDefault();
    e.stopPropagation();
    
    const section = sections.value.find(s => s.id === sectionId);
    if (!section) return;
    
    // Initialize contentOffset if not exists
    if (section.content.contentOffset === undefined) {
        section.content.contentOffset = 0;
    }
    
    draggingSectionContent.value = sectionId;
    sectionContentDragStart.value = { y: e.clientY };
    sectionContentOffsetStart.value = section.content.contentOffset || 0;
    
    document.addEventListener('mousemove', handleSectionContentDrag);
    document.addEventListener('mouseup', stopSectionContentDrag);
    document.body.style.cursor = 'ns-resize';
    document.body.style.userSelect = 'none';
};

const handleSectionContentDrag = (e: MouseEvent) => {
    if (!draggingSectionContent.value) return;
    
    const section = sections.value.find(s => s.id === draggingSectionContent.value);
    if (!section) return;
    
    const deltaY = e.clientY - sectionContentDragStart.value.y;
    section.content.contentOffset = sectionContentOffsetStart.value + deltaY;
};

const stopSectionContentDrag = () => {
    draggingSectionContent.value = null;
    document.removeEventListener('mousemove', handleSectionContentDrag);
    document.removeEventListener('mouseup', stopSectionContentDrag);
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
};

const getSectionContentTransform = (section: Section): string => {
    const offset = section.content?.contentOffset;
    if (!offset || offset === 0) return '';
    return `translateY(${offset}px)`;
};

const hasSectionContentOffset = (section: Section): boolean => {
    return section.content?.contentOffset && section.content.contentOffset !== 0;
};

const resetSectionContentOffset = (sectionId: string) => {
    const section = sections.value.find(s => s.id === sectionId);
    if (!section) return;
    section.content.contentOffset = 0;
};

// Inline Editing Functions
const startInlineEdit = (sectionId: string, field: string, currentValue: string, itemIndex?: number) => {
    editingField.value = { sectionId, field, itemIndex };
    editingValue.value = currentValue || '';
    nextTick(() => {
        const input = document.querySelector('.inline-edit-input') as HTMLInputElement | HTMLTextAreaElement;
        if (input) {
            input.focus();
            input.select();
        }
    });
};

const saveInlineEdit = () => {
    if (!editingField.value) return;
    const section = sections.value.find(s => s.id === editingField.value?.sectionId);
    if (!section) return;

    const { field, itemIndex } = editingField.value;

    if (itemIndex !== undefined && section.content.items) {
        const [itemField] = field.split('.');
        if (section.content.items[itemIndex]) {
            section.content.items[itemIndex][itemField] = editingValue.value;
        }
    } else if (field.startsWith('plans.')) {
        const parts = field.split('.');
        const planIndex = parseInt(parts[1]);
        const planField = parts[2];
        if (section.content.plans?.[planIndex]) {
            section.content.plans[planIndex][planField] = editingValue.value;
        }
    } else if (field.startsWith('navItems.')) {
        const parts = field.split('.');
        const navIndex = parseInt(parts[1]);
        const navField = parts[2];
        if (section.content.navItems?.[navIndex]) {
            section.content.navItems[navIndex][navField] = editingValue.value;
        }
    } else {
        section.content[field] = editingValue.value;
    }

    cancelInlineEdit();
};

const cancelInlineEdit = () => {
    editingField.value = null;
    editingValue.value = '';
};

const isEditing = (sectionId: string, field: string, itemIndex?: number): boolean => {
    if (!editingField.value) return false;
    return editingField.value.sectionId === sectionId &&
           editingField.value.field === field &&
           editingField.value.itemIndex === itemIndex;
};

const handleInlineKeydown = (e: KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        saveInlineEdit();
    } else if (e.key === 'Escape') {
        cancelInlineEdit();
    }
};

// Default content for section types
const getDefaultContent = (type: string): Record<string, any> => {
    const defaults: Record<string, Record<string, any>> = {
        navigation: {
            logo: '',
            logoText: props.site.name,
            navItems: props.pages.filter(p => p.showInNav).map(p => ({
                id: `nav-${p.id}`,
                label: p.title,
                url: p.isHomepage ? '/' : `/${p.slug}`,
                pageId: p.id,
                isExternal: false,
                children: [],
            })),
            showCta: true,
            ctaText: 'Contact Us',
            ctaLink: '#contact',
            sticky: true,
            style: 'default',
        },
        hero: { title: 'Welcome to Our Business', subtitle: 'We help you grow and succeed', buttonText: 'Get Started', buttonLink: '#contact', textPosition: 'center', backgroundImage: '' },
        'page-header': { title: 'Page Title', subtitle: 'A brief description of this page', backgroundImage: '', backgroundColor: '#1e40af', textColor: '#ffffff', textPosition: 'center' },
        about: { title: 'About Us', description: 'Tell your story here. Share your mission, values, and what makes you unique.', image: '', imagePosition: 'right' },
        services: { title: 'Our Services', items: [{ title: 'Service 1', description: 'Description of service 1' }, { title: 'Service 2', description: 'Description of service 2' }, { title: 'Service 3', description: 'Description of service 3' }] },
        features: { title: 'Why Choose Us', items: [{ title: 'Feature 1', description: 'Description' }, { title: 'Feature 2', description: 'Description' }] },
        gallery: { title: 'Our Gallery', images: [] },
        testimonials: { title: 'What Our Clients Say', items: [{ name: 'John Doe', text: 'Great service!', role: 'Customer' }] },
        pricing: { title: 'Pricing Plans', plans: [{ name: 'Basic', price: 'K99', features: ['Feature 1', 'Feature 2'] }] },
        products: { title: 'Our Products', showAll: true, limit: 6 },
        contact: { title: 'Contact Us', description: 'Get in touch with us', showForm: true, email: '', phone: '', address: '' },
        cta: { title: 'Ready to Get Started?', description: 'Contact us today for a free consultation', buttonText: 'Contact Us', buttonLink: '#contact' },
        text: { content: '<p>Enter your text content here...</p>' },
        // New section types
        faq: { 
            title: 'Frequently Asked Questions', 
            items: [
                { question: 'What services do you offer?', answer: 'We offer a wide range of services to meet your needs.' },
                { question: 'How can I contact you?', answer: 'You can reach us through our contact form or call us directly.' },
                { question: 'What are your business hours?', answer: 'We are open Monday to Friday, 9am to 5pm.' },
            ] 
        },
        team: { 
            title: 'Meet Our Team', 
            items: [
                { name: 'John Smith', role: 'CEO', image: '', bio: 'Leading our company with vision and passion.' },
                { name: 'Jane Doe', role: 'CTO', image: '', bio: 'Driving innovation and technology.' },
            ] 
        },
        blog: { 
            title: 'Latest News', 
            showLatest: true, 
            limit: 3,
            posts: [
                { title: 'Blog Post Title', excerpt: 'A brief excerpt of the blog post...', date: new Date().toISOString().split('T')[0], image: '' },
            ]
        },
        stats: { 
            title: 'Our Impact', 
            items: [
                { value: '500+', label: 'Happy Clients' },
                { value: '10+', label: 'Years Experience' },
                { value: '50+', label: 'Projects Completed' },
                { value: '24/7', label: 'Support' },
            ] 
        },
        map: { 
            title: 'Find Us', 
            address: '123 Business Street, City, Country',
            embedUrl: '',
            showAddress: true,
        },
        video: { 
            title: 'Watch Our Story', 
            videoUrl: '',
            videoType: 'youtube', // youtube, vimeo, or direct
            autoplay: false,
            description: 'Learn more about what we do.',
        },
        divider: { 
            style: 'line', // line, dots, space
            height: 40,
            color: '#e5e7eb',
        },
    };
    return defaults[type] || {};
};

// Update section content
const updateSectionContent = (key: string, value: any) => {
    if (!selectedSection.value) return;
    selectedSection.value.content[key] = value;
};

const updateSectionStyle = (key: string, value: any) => {
    if (!selectedSection.value) return;
    selectedSection.value.style[key] = value;
};

// Items management for services, features, testimonials
const addItem = () => {
    if (!selectedSection.value) return;
    const type = selectedSection.value.type;
    if (!selectedSection.value.content.items) {
        selectedSection.value.content.items = [];
    }
    if (type === 'services' || type === 'features') {
        selectedSection.value.content.items.push({ title: 'New Item', description: 'Description' });
    } else if (type === 'testimonials') {
        selectedSection.value.content.items.push({ name: 'Customer Name', text: 'Testimonial text', role: 'Role' });
    }
};

const removeItem = (index: number) => {
    if (!selectedSection.value?.content.items) return;
    selectedSection.value.content.items.splice(index, 1);
};

// Navigation Items Management
const addNavItem = () => {
    if (!selectedSection.value || selectedSection.value.type !== 'navigation') return;
    if (!selectedSection.value.content.navItems) {
        selectedSection.value.content.navItems = [];
    }
    selectedSection.value.content.navItems.push({
        id: `nav-${Date.now()}`,
        label: 'New Link',
        url: '#',
        pageId: null,
        isExternal: false,
        children: [],
    });
};

const removeNavItem = (index: number) => {
    if (!selectedSection.value?.content.navItems) return;
    selectedSection.value.content.navItems.splice(index, 1);
};

const addNavDropdownItem = (parentIndex: number) => {
    if (!selectedSection.value?.content.navItems?.[parentIndex]) return;
    if (!selectedSection.value.content.navItems[parentIndex].children) {
        selectedSection.value.content.navItems[parentIndex].children = [];
    }
    selectedSection.value.content.navItems[parentIndex].children.push({
        id: `nav-child-${Date.now()}`,
        label: 'Dropdown Item',
        url: '#',
        pageId: null,
        isExternal: false,
        children: [],
    });
};

const removeNavDropdownItem = (parentIndex: number, childIndex: number) => {
    if (!selectedSection.value?.content.navItems?.[parentIndex]?.children) return;
    selectedSection.value.content.navItems[parentIndex].children.splice(childIndex, 1);
};

const updateNavItemFromPage = (navIndex: number, pageId: number | null) => {
    if (!selectedSection.value?.content.navItems?.[navIndex]) return;
    const navItem = selectedSection.value.content.navItems[navIndex];
    if (pageId) {
        const page = props.pages.find(p => p.id === pageId);
        if (page) {
            navItem.label = page.title;
            navItem.url = page.isHomepage ? '/' : `/${page.slug}`;
            navItem.pageId = page.id;
            navItem.isExternal = false;
        }
    } else {
        navItem.pageId = null;
    }
};

// Pricing plans management
const addPlan = () => {
    if (!selectedSection.value) return;
    if (!selectedSection.value.content.plans) {
        selectedSection.value.content.plans = [];
    }
    selectedSection.value.content.plans.push({ name: 'New Plan', price: 'K0', features: ['Feature 1'] });
};

const removePlan = (index: number) => {
    if (!selectedSection.value?.content.plans) return;
    selectedSection.value.content.plans.splice(index, 1);
};

const addPlanFeature = (planIndex: number) => {
    if (!selectedSection.value?.content.plans?.[planIndex]) return;
    if (!selectedSection.value.content.plans[planIndex].features) {
        selectedSection.value.content.plans[planIndex].features = [];
    }
    selectedSection.value.content.plans[planIndex].features.push('New Feature');
};

// FAQ items management
const addFaqItem = () => {
    if (!selectedSection.value) return;
    if (!selectedSection.value.content.items) {
        selectedSection.value.content.items = [];
    }
    selectedSection.value.content.items.push({ question: 'New Question?', answer: 'Answer here...' });
};

const removeFaqItem = (index: number) => {
    if (!selectedSection.value?.content.items) return;
    selectedSection.value.content.items.splice(index, 1);
};

// Team members management
const addTeamMember = () => {
    if (!selectedSection.value) return;
    if (!selectedSection.value.content.items) {
        selectedSection.value.content.items = [];
    }
    selectedSection.value.content.items.push({ name: 'New Member', role: 'Role', image: '', bio: '' });
};

const removeTeamMember = (index: number) => {
    if (!selectedSection.value?.content.items) return;
    selectedSection.value.content.items.splice(index, 1);
};

// Blog posts management
const addBlogPost = () => {
    if (!selectedSection.value) return;
    if (!selectedSection.value.content.posts) {
        selectedSection.value.content.posts = [];
    }
    selectedSection.value.content.posts.push({ 
        title: 'New Post', 
        excerpt: 'Post excerpt...', 
        date: new Date().toISOString().split('T')[0], 
        image: '' 
    });
};

const removeBlogPost = (index: number) => {
    if (!selectedSection.value?.content.posts) return;
    selectedSection.value.content.posts.splice(index, 1);
};

// Stats items management
const addStatItem = () => {
    if (!selectedSection.value) return;
    if (!selectedSection.value.content.items) {
        selectedSection.value.content.items = [];
    }
    selectedSection.value.content.items.push({ value: '100+', label: 'New Stat' });
};

const removeStatItem = (index: number) => {
    if (!selectedSection.value?.content.items) return;
    selectedSection.value.content.items.splice(index, 1);
};

// Page Management Functions
const openCreatePageModal = () => {
    newPageForm.value = { title: '', slug: '', showInNav: true, templateId: 'blank' };
    pageError.value = null;
    createPageStep.value = 'template';
    showCreatePageModal.value = true;
};

const selectTemplate = (templateId: string) => {
    newPageForm.value.templateId = templateId;
    const template = pageTemplates.find(t => t.id === templateId);
    if (template && templateId !== 'blank') {
        // Pre-fill title based on template (but not for homepage templates since we're creating a new page)
        newPageForm.value.title = template.isHomepage ? '' : template.name;
        // Generate unique slug to avoid conflicts
        newPageForm.value.slug = template.isHomepage ? '' : template.id;
    } else {
        newPageForm.value.title = '';
        newPageForm.value.slug = '';
    }
    createPageStep.value = 'details';
};

const backToTemplates = () => {
    createPageStep.value = 'template';
};

// Filter templates for creating new pages (exclude homepage templates since homepage already exists)
const newPageTemplates = computed(() => pageTemplates.filter(t => !t.isHomepage));

// Apply template to current page
const openApplyTemplateModal = () => {
    showApplyTemplateModal.value = true;
};

const applyTemplate = (templateId: string) => {
    console.log('applyTemplate called with:', templateId);
    if (!activePage.value) {
        console.log('No active page');
        return;
    }

    const template = pageTemplates.find(t => t.id === templateId);
    if (!template) {
        console.log('Template not found:', templateId);
        return;
    }

    console.log('Applying template:', template.name);
    applyingTemplate.value = true;

    // Generate new sections from template
    const newSections = template.sections.map((s, i) => ({
        id: `section-${Date.now()}-${i}`,
        type: s.type,
        content: { ...s.content },
        style: { ...s.style },
    }));

    console.log('New sections:', newSections.length);

    // Replace current sections with template sections
    sections.value = newSections;

    // Update page title if it's a homepage template and current page is homepage
    if (template.isHomepage && activePage.value.isHomepage) {
        pageTitle.value = activePage.value.title; // Keep original title
    }

    showApplyTemplateModal.value = false;
    applyingTemplate.value = false;

    // Auto-save after applying template
    console.log('Saving page...');
    savePage();
};

const createPage = async () => {
    if (!newPageForm.value.title) {
        pageError.value = 'Please enter a page title';
        return;
    }

    const slug =
        newPageForm.value.slug ||
        newPageForm.value.title
            .toLowerCase()
            .replace(/\s+/g, '-')
            .replace(/[^a-z0-9-]/g, '');

    // Check if slug already exists and warn the user
    const existingPage = props.pages.find(p => p.slug === slug);
    if (existingPage) {
        pageError.value = `A page with the URL "/${slug}" already exists ("${existingPage.title}"). Please choose a different title or URL slug.`;
        return;
    }

    creatingPage.value = true;
    pageError.value = null;

    // Get template sections
    const template = pageTemplates.find(t => t.id === newPageForm.value.templateId);
    const templateSections = template?.sections.map((s, i) => ({
        id: `section-${Date.now()}-${i}`,
        type: s.type,
        content: { ...s.content },
        style: { ...s.style },
    })) || [];

    try {
        const response = await axios.post(`/growbuilder/editor/${props.site.id}/pages`, {
            title: newPageForm.value.title,
            slug: slug,
            sections: templateSections,
            show_in_nav: newPageForm.value.showInNav,
            is_homepage: false,
        });

        // Add to navigation if showInNav is true
        if (newPageForm.value.showInNav && response.data.page?.id) {
            siteNavigation.value.navItems.push({
                id: `nav-${response.data.page.id}`,
                label: newPageForm.value.title,
                url: `/${slug}`,
                pageId: response.data.page.id,
                isExternal: false,
                children: [],
            });
            // Save navigation settings
            await axios.post(`/growbuilder/editor/${props.site.id}/settings`, {
                navigation: siteNavigation.value,
                footer: siteFooter.value,
            });
        }

        showCreatePageModal.value = false;

        // Reset form
        newPageForm.value = { title: '', slug: '', showInNav: true, templateId: 'blank' };
        createPageStep.value = 'template';

        // Switch to the new page
        if (response.data.page?.id) {
            router.visit(`/growbuilder/editor/${props.site.id}?page=${response.data.page.id}`);
        } else {
            router.reload();
        }
    } catch (error: any) {
        console.error('Failed to create page:', error);
        pageError.value = error.response?.data?.error || error.response?.data?.message || 'Failed to create page. Please try again.';
    } finally {
        creatingPage.value = false;
    }
};

const openEditPageModal = (page: Page) => {
    editingPage.value = page;
    showEditPageModal.value = true;
};

const updatePage = async () => {
    if (!editingPage.value) return;
    
    try {
        // Get original page to check if showInNav changed
        const originalPage = props.pages.find(p => p.id === editingPage.value?.id);
        const showInNavChanged = originalPage?.showInNav !== editingPage.value.showInNav;
        
        await axios.put(`/growbuilder/editor/${props.site.id}/pages/${editingPage.value.id}`, {
            title: editingPage.value.title,
            slug: editingPage.value.slug,
            show_in_nav: editingPage.value.showInNav,
        });
        
        // Sync navigation if showInNav changed
        if (showInNavChanged) {
            const navIndex = siteNavigation.value.navItems.findIndex(item => item.pageId === editingPage.value?.id);
            
            if (editingPage.value.showInNav && navIndex === -1) {
                // Add to navigation
                siteNavigation.value.navItems.push({
                    id: `nav-${editingPage.value.id}`,
                    label: editingPage.value.title,
                    url: editingPage.value.isHomepage ? '/' : `/${editingPage.value.slug}`,
                    pageId: editingPage.value.id,
                    isExternal: false,
                    children: [],
                });
            } else if (!editingPage.value.showInNav && navIndex !== -1) {
                // Remove from navigation
                siteNavigation.value.navItems.splice(navIndex, 1);
            }
            
            // Save navigation settings
            await axios.post(`/growbuilder/editor/${props.site.id}/settings`, {
                navigation: siteNavigation.value,
                footer: siteFooter.value,
            });
        } else if (siteNavigation.value.navItems.some(item => item.pageId === editingPage.value?.id)) {
            // Update nav item label/url if page title/slug changed
            const navItem = siteNavigation.value.navItems.find(item => item.pageId === editingPage.value?.id);
            if (navItem) {
                navItem.label = editingPage.value.title;
                navItem.url = editingPage.value.isHomepage ? '/' : `/${editingPage.value.slug}`;
                
                await axios.post(`/growbuilder/editor/${props.site.id}/settings`, {
                    navigation: siteNavigation.value,
                    footer: siteFooter.value,
                });
            }
        }
        
        showEditPageModal.value = false;
        editingPage.value = null;
        router.reload({ only: ['pages'] });
    } catch (error) {
        console.error('Failed to update page:', error);
    }
};

const deletePage = async (pageId: number) => {
    const page = props.pages.find(p => p.id === pageId);
    if (!page || page.isHomepage) return;
    
    if (!confirm(`Delete "${page.title}"? This cannot be undone.`)) return;
    
    try {
        await axios.delete(`/growbuilder/editor/${props.site.id}/pages/${pageId}`);
        
        // Remove from navigation
        const navIndex = siteNavigation.value.navItems.findIndex(item => item.pageId === pageId);
        if (navIndex !== -1) {
            siteNavigation.value.navItems.splice(navIndex, 1);
            // Save navigation settings
            await axios.post(`/growbuilder/editor/${props.site.id}/settings`, {
                navigation: siteNavigation.value,
                footer: siteFooter.value,
            });
        }
        
        router.reload({ only: ['pages'] });
        
        // If we deleted the active page, switch to homepage
        if (activePage.value?.id === pageId) {
            const homepage = props.pages.find(p => p.isHomepage);
            if (homepage) {
                router.get(`/growbuilder/editor/${props.site.id}`, { page: homepage.id });
            }
        }
    } catch (error) {
        console.error('Failed to delete page:', error);
    }
};

// Save page
const savePage = async () => {
    if (!activePage.value) return;
    saving.value = true;
    try {
        // Save page content
        await axios.post(`/growbuilder/editor/${props.site.id}/pages/${activePage.value.id}/save`, {
            title: pageTitle.value,
            content: { sections: sections.value },
        });
        
        // Save site settings (navigation and footer)
        await axios.post(`/growbuilder/editor/${props.site.id}/settings`, {
            navigation: siteNavigation.value,
            footer: siteFooter.value,
        });
    } catch (error) {
        console.error('Save failed:', error);
    } finally {
        saving.value = false;
    }
};

// Open preview (auto-saves first)
const openPreview = async () => {
    await savePage();
    window.open(`${props.site.url}?t=${Date.now()}`, '_blank');
};

// Switch page
const switchPage = (page: Page) => {
    if (page.id === activePage.value?.id) return;
    router.visit(`/growbuilder/editor/${props.site.id}?page=${page.id}`);
};

// Drag handlers
const onDragStart = () => {
    isDragging.value = true;
};

const onDragEnd = () => {
    isDragging.value = false;
};

// Clone section from sidebar for drag-and-drop
const cloneSection = (type: string) => {
    return {
        id: `section-${Date.now()}`,
        type,
        content: getDefaultContent(type),
        style: { backgroundColor: '#ffffff', textColor: '#111827' },
    };
};

// Handle drop from widget palette
const onWidgetDrop = (evt: any) => {
    isDragging.value = false;
    if (evt.added) {
        const newSection = evt.added.element;
        selectedSectionId.value = newSection.id;
    }
};

// Toggle widget category
const toggleWidgetCategory = (category: string) => {
    widgetCategoryExpanded.value[category] = !widgetCategoryExpanded.value[category];
};

// Theme colors
const themeColors = [
    { name: 'White', value: '#ffffff' },
    { name: 'Light Gray', value: '#f9fafb' },
    { name: 'Gray', value: '#f3f4f6' },
    { name: 'Blue', value: '#eff6ff' },
    { name: 'Green', value: '#f0fdf4' },
    { name: 'Purple', value: '#faf5ff' },
    { name: 'Dark', value: '#1f2937' },
    { name: 'Navy', value: '#1e3a5f' },
];

// Generate slug from title
const generateSlug = (title: string) => {
    return title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
};

watch(() => newPageForm.value.title, (title) => {
    if (title && !newPageForm.value.slug) {
        newPageForm.value.slug = generateSlug(title);
    }
});

// Image Upload Functions
const openMediaLibrary = async (
    target: 'navigation' | 'footer' | 'section',
    fieldOrSectionId: string,
    field?: string,
    itemIndex?: number
) => {
    if (target === 'navigation' || target === 'footer') {
        mediaLibraryTarget.value = { target, field: fieldOrSectionId };
    } else {
        mediaLibraryTarget.value = { target: 'section', sectionId: fieldOrSectionId, field: field!, itemIndex };
    }
    showMediaLibrary.value = true;
    await loadMediaLibrary();
};

const loadMediaLibrary = async () => {
    try {
        const response = await axios.get(`/growbuilder/media/${props.site.id}`);
        mediaLibrary.value = response.data.data || [];
    } catch (error) {
        console.error('Failed to load media library:', error);
    }
};

const uploadImage = async (event: Event) => {
    const input = event.target as HTMLInputElement;
    if (!input.files?.length) return;

    const file = input.files[0];
    uploadingImage.value = true;
    imageUploadError.value = null;

    const formData = new FormData();
    formData.append('file', file);

    try {
        const response = await axios.post(`/growbuilder/media/${props.site.id}`, formData, {
            headers: { 'Content-Type': 'multipart/form-data' },
        });

        if (response.data.success) {
            // Add to library
            mediaLibrary.value.unshift(response.data.media);
            // Select the uploaded image
            selectMediaImage(response.data.media);
        }
    } catch (error: any) {
        imageUploadError.value = error.response?.data?.message || 'Failed to upload image';
    } finally {
        uploadingImage.value = false;
        input.value = '';
    }
};

const selectMediaImage = (media: any) => {
    if (!mediaLibraryTarget.value) return;

    const { target, sectionId, field, itemIndex } = mediaLibraryTarget.value;

    if (target === 'navigation') {
        siteNavigation.value.logo = media.url;
    } else if (target === 'footer') {
        siteFooter.value.logo = media.url;
    } else if (target === 'section' && sectionId) {
        const section = sections.value.find(s => s.id === sectionId);
        if (section && field) {
            if (itemIndex !== undefined && section.content.items) {
                section.content.items[itemIndex][field] = media.url;
            } else if (field === 'images' && section.type === 'gallery') {
                if (!section.content.images) section.content.images = [];
                section.content.images.push({ id: media.id, url: media.url, alt: media.originalName });
            } else {
                section.content[field] = media.url;
            }
        }
    }

    showMediaLibrary.value = false;
    mediaLibraryTarget.value = null;
};

const removeGalleryImage = (sectionId: string, imageIndex: number) => {
    const section = sections.value.find(s => s.id === sectionId);
    if (section?.content.images) {
        section.content.images.splice(imageIndex, 1);
    }
};

// Footer Management Functions
const addFooterColumn = () => {
    siteFooter.value.columns.push({
        id: `col-${Date.now()}`,
        title: 'New Column',
        links: [],
    });
};

const removeFooterColumn = (index: number) => {
    siteFooter.value.columns.splice(index, 1);
};

const addFooterLink = (columnIndex: number) => {
    siteFooter.value.columns[columnIndex].links.push({
        id: `link-${Date.now()}`,
        label: 'New Link',
        url: '#',
    });
};

const removeFooterLink = (columnIndex: number, linkIndex: number) => {
    siteFooter.value.columns[columnIndex].links.splice(linkIndex, 1);
};

const addSocialLink = () => {
    siteFooter.value.socialLinks.push({
        id: `social-${Date.now()}`,
        platform: 'facebook',
        url: '',
    });
};

const removeSocialLink = (index: number) => {
    siteFooter.value.socialLinks.splice(index, 1);
};

const socialPlatforms = [
    { value: 'facebook', label: 'Facebook' },
    { value: 'twitter', label: 'Twitter/X' },
    { value: 'instagram', label: 'Instagram' },
    { value: 'linkedin', label: 'LinkedIn' },
    { value: 'youtube', label: 'YouTube' },
    { value: 'tiktok', label: 'TikTok' },
];
</script>

<template>
    <Head :title="`Edit - ${site.name}`" />

    <div class="h-screen flex flex-col bg-gray-100 overflow-hidden">
        <!-- Top Toolbar -->
        <header class="h-14 bg-white border-b border-gray-200 flex items-center justify-between px-4 flex-shrink-0 shadow-sm">
            <div class="flex items-center gap-3">
                <button
                    @click="router.visit('/growbuilder')"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    aria-label="Back to dashboard"
                >
                    <ChevronLeftIcon class="w-5 h-5 text-gray-600" aria-hidden="true" />
                </button>
                <div class="h-6 w-px bg-gray-200"></div>
                <div>
                    <h1 class="text-sm font-semibold text-gray-900">{{ site.name }}</h1>
                    <p class="text-xs text-gray-500">{{ activePage?.title || 'No page selected' }}</p>
                </div>
            </div>

            <div class="flex items-center gap-2">
                <!-- Preview Mode Toggle -->
                <div class="flex items-center bg-gray-100 rounded-lg p-1">
                    <button
                        @click="previewMode = 'desktop'"
                        :class="['p-1.5 rounded-md transition-all', previewMode === 'desktop' ? 'bg-white shadow-sm text-blue-600' : 'text-gray-500 hover:text-gray-700']"
                        aria-label="Desktop preview"
                    >
                        <ComputerDesktopIcon class="w-4 h-4" aria-hidden="true" />
                    </button>
                    <button
                        @click="previewMode = 'mobile'"
                        :class="['p-1.5 rounded-md transition-all', previewMode === 'mobile' ? 'bg-white shadow-sm text-blue-600' : 'text-gray-500 hover:text-gray-700']"
                        aria-label="Mobile preview"
                    >
                        <DevicePhoneMobileIcon class="w-4 h-4" aria-hidden="true" />
                    </button>
                </div>

                <div class="h-6 w-px bg-gray-200"></div>

                <button
                    @click="openPreview"
                    class="flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
                >
                    <EyeIcon class="w-4 h-4" aria-hidden="true" />
                    <span>Preview</span>
                </button>

                <button
                    @click="savePage"
                    :disabled="saving"
                    class="flex items-center gap-1.5 px-4 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors shadow-sm"
                >
                    <span v-if="saving">Saving...</span>
                    <span v-else>Save</span>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Left Sidebar -->
            <aside :class="['bg-white border-r border-gray-200 flex flex-col transition-all duration-300 flex-shrink-0', leftSidebarOpen ? 'w-72' : 'w-0']">
                <div v-if="leftSidebarOpen" class="flex flex-col h-full overflow-hidden">
                    <!-- Sidebar Tabs -->
                    <div class="flex border-b border-gray-200">
                        <button
                            @click="activeLeftTab = 'widgets'"
                            :class="['flex-1 flex items-center justify-center gap-2 py-3 text-sm font-medium transition-colors border-b-2', activeLeftTab === 'widgets' ? 'text-blue-600 border-blue-600 bg-blue-50/50' : 'text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50']"
                        >
                            <Squares2X2Icon class="w-4 h-4" aria-hidden="true" />
                            Widgets
                        </button>
                        <button
                            @click="activeLeftTab = 'pages'"
                            :class="['flex-1 flex items-center justify-center gap-2 py-3 text-sm font-medium transition-colors border-b-2', activeLeftTab === 'pages' ? 'text-blue-600 border-blue-600 bg-blue-50/50' : 'text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-50']"
                        >
                            <DocumentIcon class="w-4 h-4" aria-hidden="true" />
                            Pages
                        </button>
                    </div>

                    <!-- Widget Palette Tab -->
                    <div v-if="activeLeftTab === 'widgets'" class="flex-1 overflow-y-auto">
                        <div class="px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100">
                            <p class="text-xs text-blue-700 font-medium flex items-center gap-1.5">
                                <ArrowsUpDownIcon class="w-3.5 h-3.5" aria-hidden="true" />
                                Drag widgets to the canvas
                            </p>
                        </div>

                        <div class="p-3 space-y-2">
                            <div v-for="category in sectionCategories" :key="category">
                                <button
                                    @click="toggleWidgetCategory(category)"
                                    class="w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wide hover:text-gray-700 transition-colors"
                                >
                                    <span>{{ category }}</span>
                                    <ChevronDownIcon :class="['w-3.5 h-3.5 transition-transform', widgetCategoryExpanded[category] ? '' : '-rotate-90']" aria-hidden="true" />
                                </button>

                                <div v-if="widgetCategoryExpanded[category]" class="mt-1">
                                    <draggable
                                        :list="sectionBlocks.filter(b => b.category === category)"
                                        :group="{ name: 'sections', pull: 'clone', put: false }"
                                        :clone="(item: SectionType) => cloneSection(item.type)"
                                        item-key="type"
                                        :sort="false"
                                        ghost-class="opacity-0"
                                        @start="onDragStart"
                                        @end="onDragEnd"
                                        class="grid grid-cols-2 gap-2"
                                    >
                                        <template #item="{ element }">
                                            <div class="group flex flex-col items-center p-3 bg-gray-50 rounded-xl cursor-grab hover:bg-blue-50 hover:ring-2 hover:ring-blue-200 transition-all active:cursor-grabbing">
                                                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center mb-2 shadow-sm group-hover:shadow group-hover:bg-blue-100 transition-all">
                                                    <component :is="element.icon" class="w-5 h-5 text-gray-500 group-hover:text-blue-600" aria-hidden="true" />
                                                </div>
                                                <span class="text-xs font-medium text-gray-700 group-hover:text-blue-700 text-center">{{ element.name }}</span>
                                            </div>
                                        </template>
                                    </draggable>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pages Tab -->
                    <div v-if="activeLeftTab === 'pages'" class="flex-1 overflow-y-auto">
                        <!-- Add Page Button -->
                        <div class="p-3 border-b border-gray-100">
                            <button
                                @click="openCreatePageModal"
                                class="w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                <PlusIcon class="w-4 h-4" aria-hidden="true" />
                                Add New Page
                            </button>
                        </div>

                        <!-- Pages List -->
                        <div class="p-3 space-y-1">
                            <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">Site Pages</p>
                            <div
                                v-for="page in pages"
                                :key="page.id"
                                :class="['group flex items-center gap-2 px-3 py-2.5 rounded-lg cursor-pointer transition-all', activePage?.id === page.id ? 'bg-blue-50 ring-1 ring-blue-200' : 'hover:bg-gray-50']"
                                @click="switchPage(page)"
                            >
                                <DocumentIcon :class="['w-4 h-4', activePage?.id === page.id ? 'text-blue-600' : 'text-gray-400']" aria-hidden="true" />
                                <span :class="['flex-1 text-sm truncate', activePage?.id === page.id ? 'text-blue-700 font-medium' : 'text-gray-700']">
                                    {{ page.title }}
                                </span>
                                <span v-if="page.isHomepage" class="text-xs text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded">Home</span>
                                <div class="opacity-0 group-hover:opacity-100 flex items-center gap-1">
                                    <button @click.stop="openEditPageModal(page)" class="p-1 hover:bg-gray-200 rounded" aria-label="Edit page">
                                        <PencilIcon class="w-3.5 h-3.5 text-gray-500" aria-hidden="true" />
                                    </button>
                                    <button v-if="!page.isHomepage" @click.stop="deletePage(page.id)" class="p-1 hover:bg-red-100 rounded" aria-label="Delete page">
                                        <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Apply Template Button -->
                        <div class="px-3 pb-3">
                            <button
                                @click="openApplyTemplateModal"
                                class="w-full flex items-center justify-center gap-2 px-3 py-2 text-sm text-gray-600 border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-colors"
                            >
                                <SparklesIcon class="w-4 h-4" aria-hidden="true" />
                                <span>Apply Template to Page</span>
                            </button>
                        </div>

                        <!-- Page Sections List -->
                        <div class="p-3 border-t border-gray-100">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Page Sections</p>
                                <span class="text-xs text-gray-400">{{ sections.length }}</span>
                            </div>
                            <draggable
                                v-model="sections"
                                item-key="id"
                                handle=".drag-handle"
                                ghost-class="opacity-50"
                                @start="onDragStart"
                                @end="onDragEnd"
                                class="space-y-1"
                            >
                                <template #item="{ element }">
                                    <div
                                        :class="['group flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-all', selectedSectionId === element.id ? 'bg-blue-50 ring-1 ring-blue-200' : 'hover:bg-gray-50']"
                                        @click="selectSection(element.id)"
                                    >
                                        <ArrowsUpDownIcon class="drag-handle w-4 h-4 text-gray-300 cursor-grab hover:text-gray-500" aria-hidden="true" />
                                        <component :is="sectionBlocks.find(b => b.type === element.type)?.icon || Squares2X2Icon" class="w-4 h-4 text-gray-400" aria-hidden="true" />
                                        <span class="flex-1 text-sm text-gray-700 truncate capitalize">{{ element.type }}</span>
                                        <button @click.stop="deleteSection(element.id)" class="opacity-0 group-hover:opacity-100 p-1 hover:bg-red-100 rounded transition-all" aria-label="Delete section">
                                            <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                        </button>
                                    </div>
                                </template>
                            </draggable>
                            <div v-if="sections.length === 0" class="text-center py-6 text-gray-400">
                                <Squares2X2Icon class="w-8 h-8 mx-auto mb-2" aria-hidden="true" />
                                <p class="text-xs">No sections yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Toggle Left Sidebar -->
            <button
                @click="leftSidebarOpen = !leftSidebarOpen"
                class="absolute left-0 top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white border border-gray-200 rounded-r-lg shadow-sm hover:bg-gray-50 transition-colors"
                :class="leftSidebarOpen ? 'ml-72' : 'ml-0'"
                aria-label="Toggle left sidebar"
            >
                <ChevronLeftIcon :class="['w-4 h-4 text-gray-500 transition-transform', leftSidebarOpen ? '' : 'rotate-180']" aria-hidden="true" />
            </button>

            <!-- Canvas Area -->
            <main class="flex-1 overflow-auto p-6 bg-gray-100">
                <div :class="['mx-auto transition-all duration-300', canvasWidth]">
                    <div :class="['bg-white rounded-xl shadow-lg overflow-hidden transition-all', previewMode === 'mobile' ? 'max-w-sm mx-auto' : '', isDragging ? 'ring-2 ring-blue-400 ring-dashed' : '']">
                        
                        <!-- Site-Wide Navigation (appears on all pages) -->
                        <div 
                            class="relative group cursor-pointer"
                            :class="[
                                showNavSettings ? 'ring-2 ring-blue-500 ring-inset' : 'hover:ring-1 hover:ring-blue-300 hover:ring-inset',
                                siteNavigation.style === 'transparent' ? 'absolute top-0 left-0 right-0 z-10' : '',
                                siteNavigation.style === 'floating' ? 'm-3 rounded-xl shadow-lg' : 'border-b border-gray-200'
                            ]"
                            @click="showNavSettings = true; showFooterSettings = false; selectedSectionId = null"
                        >
                            <!-- Nav Edit Indicator -->
                            <div v-if="showNavSettings" class="absolute top-2 right-2 z-10 flex items-center gap-1 bg-white rounded-lg shadow-lg border border-gray-200 p-1">
                                <span class="text-xs text-blue-600 font-medium px-2">Editing Navigation</span>
                            </div>
                            <div 
                                :class="[
                                    'transition-all',
                                    isMobilePreview ? 'py-3 px-4' : 'py-4 px-6',
                                    {
                                        'bg-white': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'centered' || siteNavigation.style === 'split' || siteNavigation.style === 'mega',
                                        'bg-transparent': siteNavigation.style === 'transparent',
                                        'bg-gray-900': siteNavigation.style === 'dark' || siteNavigation.style === 'sidebar',
                                        'bg-white/95 backdrop-blur-sm rounded-xl': siteNavigation.style === 'floating'
                                    }
                                ]"
                            >
                                <!-- Mobile Navigation Preview -->
                                <div v-if="isMobilePreview" class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <img v-if="siteNavigation.logo" :src="siteNavigation.logo" class="h-6 object-contain" alt="Logo" />
                                        <span 
                                            v-else 
                                            class="font-bold text-sm"
                                            :class="{
                                                'text-gray-900': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'floating' || siteNavigation.style === 'mega',
                                                'text-white': siteNavigation.style === 'transparent' || siteNavigation.style === 'dark'
                                            }"
                                        >
                                            {{ siteNavigation.logoText || site.name }}
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button 
                                            v-if="siteNavigation.showCta" 
                                            class="px-3 py-1.5 text-xs font-medium rounded-lg transition-colors"
                                            :class="{
                                                'bg-blue-600 text-white': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'floating' || siteNavigation.style === 'mega',
                                                'bg-white text-gray-900': siteNavigation.style === 'transparent' || siteNavigation.style === 'dark'
                                            }"
                                        >
                                            {{ siteNavigation.ctaText || 'Contact' }}
                                        </button>
                                        <div 
                                            class="p-1.5 rounded"
                                            :class="{
                                                'text-gray-600': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'floating',
                                                'text-white': siteNavigation.style === 'transparent' || siteNavigation.style === 'dark'
                                            }"
                                        >
                                            <Bars3Icon class="w-5 h-5" aria-hidden="true" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Desktop: Default, Dark, Transparent, Floating, Mega Styles -->
                                <div 
                                    v-else-if="!siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'transparent' || siteNavigation.style === 'dark' || siteNavigation.style === 'floating' || siteNavigation.style === 'mega'"
                                    class="flex items-center justify-between"
                                >
                                    <div class="flex items-center gap-2">
                                        <img v-if="siteNavigation.logo" :src="siteNavigation.logo" class="h-8 object-contain" alt="Logo" />
                                        <span 
                                            v-else 
                                            class="font-bold text-lg"
                                            :class="{
                                                'text-gray-900': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'floating' || siteNavigation.style === 'mega',
                                                'text-white': siteNavigation.style === 'transparent' || siteNavigation.style === 'dark'
                                            }"
                                        >
                                            {{ siteNavigation.logoText || site.name }}
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <template v-for="(navItem, idx) in siteNavigation.navItems" :key="navItem.id || idx">
                                            <span 
                                                class="text-sm cursor-pointer"
                                                :class="{
                                                    'text-gray-600 hover:text-blue-600': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'floating' || siteNavigation.style === 'mega',
                                                    'text-white/90 hover:text-white': siteNavigation.style === 'transparent' || siteNavigation.style === 'dark'
                                                }"
                                            >
                                                {{ navItem.label }}
                                                <span v-if="siteNavigation.style === 'mega'" class="text-xs ml-0.5">▼</span>
                                            </span>
                                        </template>
                                        <span v-if="siteNavigation.navItems.length === 0" class="text-sm text-gray-400 italic">No nav items</span>
                                        <button 
                                            v-if="siteNavigation.showCta" 
                                            class="px-4 py-2 text-sm font-medium rounded-lg transition-colors"
                                            :class="{
                                                'bg-blue-600 text-white hover:bg-blue-700': !siteNavigation.style || siteNavigation.style === 'default' || siteNavigation.style === 'floating' || siteNavigation.style === 'mega',
                                                'bg-white text-gray-900 hover:bg-gray-100': siteNavigation.style === 'transparent' || siteNavigation.style === 'dark'
                                            }"
                                        >
                                            {{ siteNavigation.ctaText || 'Contact Us' }}
                                        </button>
                                    </div>
                                </div>

                                <!-- Centered Style -->
                                <div v-else-if="siteNavigation.style === 'centered'" class="flex flex-col items-center gap-3">
                                    <div class="flex items-center gap-2">
                                        <img v-if="siteNavigation.logo" :src="siteNavigation.logo" class="h-10 object-contain" alt="Logo" />
                                        <span v-else class="font-bold text-xl text-gray-900">{{ siteNavigation.logoText || site.name }}</span>
                                    </div>
                                    <div class="flex items-center gap-6">
                                        <template v-for="(navItem, idx) in siteNavigation.navItems" :key="navItem.id || idx">
                                            <span class="text-sm text-gray-600 hover:text-blue-600 cursor-pointer">{{ navItem.label }}</span>
                                        </template>
                                        <button v-if="siteNavigation.showCta" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg">
                                            {{ siteNavigation.ctaText || 'Contact Us' }}
                                        </button>
                                    </div>
                                </div>

                                <!-- Split Style (logo center, links both sides) -->
                                <div v-else-if="siteNavigation.style === 'split'" class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <template v-for="(navItem, idx) in siteNavigation.navItems.slice(0, Math.ceil(siteNavigation.navItems.length / 2))" :key="navItem.id || idx">
                                            <span class="text-sm text-gray-600 hover:text-blue-600 cursor-pointer">{{ navItem.label }}</span>
                                        </template>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <img v-if="siteNavigation.logo" :src="siteNavigation.logo" class="h-10 object-contain" alt="Logo" />
                                        <span v-else class="font-bold text-xl text-gray-900">{{ siteNavigation.logoText || site.name }}</span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <template v-for="(navItem, idx) in siteNavigation.navItems.slice(Math.ceil(siteNavigation.navItems.length / 2))" :key="navItem.id || idx">
                                            <span class="text-sm text-gray-600 hover:text-blue-600 cursor-pointer">{{ navItem.label }}</span>
                                        </template>
                                        <button v-if="siteNavigation.showCta" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg">
                                            {{ siteNavigation.ctaText || 'Contact Us' }}
                                        </button>
                                    </div>
                                </div>

                                <!-- Sidebar Style (hamburger menu) -->
                                <div v-else-if="siteNavigation.style === 'sidebar'" class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <button class="p-2 hover:bg-white/10 rounded-lg">
                                            <Bars3Icon class="w-6 h-6 text-white" />
                                        </button>
                                        <img v-if="siteNavigation.logo" :src="siteNavigation.logo" class="h-8 object-contain" alt="Logo" />
                                        <span v-else class="font-bold text-lg text-white">{{ siteNavigation.logoText || site.name }}</span>
                                    </div>
                                    <button v-if="siteNavigation.showCta" class="px-4 py-2 bg-white text-gray-900 text-sm font-medium rounded-lg">
                                        {{ siteNavigation.ctaText || 'Contact Us' }}
                                    </button>
                                </div>
                            </div>
                            <div class="absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/5 transition-colors">
                                <span class="opacity-0 group-hover:opacity-100 text-xs bg-blue-600 text-white px-2 py-1 rounded transition-opacity">
                                    Click to edit navigation
                                </span>
                            </div>
                        </div>

                        <!-- Drop Zone when empty -->
                        <div v-if="isDragging && sections.length === 0" class="min-h-[400px] flex flex-col items-center justify-center p-12 bg-blue-50/50 border-2 border-dashed border-blue-300 rounded-xl m-4">
                            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4">
                                <PlusIcon class="w-8 h-8 text-blue-500" aria-hidden="true" />
                            </div>
                            <p class="text-blue-600 font-medium">Drop widget here</p>
                        </div>

                        <!-- Sections -->
                        <draggable
                            v-model="sections"
                            :group="{ name: 'sections', pull: true, put: true }"
                            item-key="id"
                            ghost-class="opacity-30"
                            drag-class="shadow-2xl"
                            @start="onDragStart"
                            @end="onDragEnd"
                            @change="onWidgetDrop"
                            :class="['min-h-[300px]', isDragging && sections.length > 0 ? 'bg-blue-50/30' : '']"
                        >
                            <template #item="{ element }">
                                <div
                                    :data-section-id="element.id"
                                    :class="['relative group transition-all', selectedSectionId === element.id ? 'ring-2 ring-blue-500 ring-inset' : '', hoveredSectionId === element.id && selectedSectionId !== element.id ? 'ring-1 ring-blue-300 ring-inset' : '', resizingSection === element.id ? 'ring-2 ring-blue-500' : '']"
                                    :style="{ minHeight: element.style?.minHeight ? `${element.style.minHeight}px` : undefined }"
                                    @click="handleSectionClick($event, element.id)"
                                    @mouseenter="hoveredSectionId = element.id"
                                    @mouseleave="hoveredSectionId = null"
                                >
                                    <!-- Section Actions Toolbar -->
                                    <div v-if="hoveredSectionId === element.id || selectedSectionId === element.id" class="absolute top-2 right-2 z-20 flex items-center gap-1 bg-white rounded-lg shadow-lg border border-gray-200 p-1">
                                        <!-- Content Position Drag Handle -->
                                        <button 
                                            @click.stop
                                            @mousedown.stop.prevent="startSectionContentDrag($event, element.id)"
                                            class="p-1.5 hover:bg-blue-100 rounded cursor-ns-resize" 
                                            :class="hasSectionContentOffset(element) ? 'bg-blue-50 text-blue-600' : ''"
                                            aria-label="Drag content vertically"
                                            title="Drag to reposition content vertically"
                                        >
                                            <ArrowsUpDownIcon class="w-4 h-4" :class="hasSectionContentOffset(element) ? 'text-blue-600' : 'text-gray-600'" aria-hidden="true" />
                                        </button>
                                        <div class="w-px h-4 bg-gray-200"></div>
                                        <button @click.stop="moveSection(element.id, 'up')" class="p-1.5 hover:bg-gray-100 rounded" aria-label="Move up">
                                            <ArrowUpIcon class="w-4 h-4 text-gray-600" aria-hidden="true" />
                                        </button>
                                        <button @click.stop="moveSection(element.id, 'down')" class="p-1.5 hover:bg-gray-100 rounded" aria-label="Move down">
                                            <ArrowDownIcon class="w-4 h-4 text-gray-600" aria-hidden="true" />
                                        </button>
                                        <button @click.stop="duplicateSection(element.id)" class="p-1.5 hover:bg-gray-100 rounded" aria-label="Duplicate">
                                            <DocumentDuplicateIcon class="w-4 h-4 text-gray-600" aria-hidden="true" />
                                        </button>
                                        <button @click.stop="deleteSection(element.id)" class="p-1.5 hover:bg-red-100 rounded" aria-label="Delete">
                                            <TrashIcon class="w-4 h-4 text-red-500" aria-hidden="true" />
                                        </button>
                                    </div>
                                    
                                    <!-- Reset Content Position Button -->
                                    <div 
                                        v-if="(hoveredSectionId === element.id || selectedSectionId === element.id) && hasSectionContentOffset(element)" 
                                        class="absolute top-2 left-2 z-20"
                                    >
                                        <button 
                                            @click.stop="resetSectionContentOffset(element.id)"
                                            class="px-2 py-1 text-xs font-medium rounded bg-white shadow-lg border border-gray-200 text-gray-600 hover:bg-gray-100 transition-colors"
                                            title="Reset content position"
                                        >
                                            Reset Position
                                        </button>
                                    </div>

                                    <!-- Section Preview Content -->
                                    <div 
                                        class="section-preview h-full" 
                                        :style="{ backgroundColor: element.style?.backgroundColor || '#ffffff' }"
                                    >
                                        <!-- Hero Section -->
                                        <div 
                                            v-if="element.type === 'hero'" 
                                            class="h-full relative overflow-hidden"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#1e40af',
                                                minHeight: element.style?.minHeight ? `${element.style.minHeight}px` : (isMobilePreview ? '350px' : '500px')
                                            }"
                                        >
                                            <!-- Background Image -->
                                            <div v-if="element.content.backgroundImage" class="absolute inset-0">
                                                <img :src="element.content.backgroundImage" class="w-full h-full object-cover" />
                                                <div class="absolute inset-0 bg-black/50"></div>
                                            </div>
                                            
                                            <!-- Reset Button (shows when any element has been moved) -->
                                            <div 
                                                v-if="selectedSectionId === element.id && (hasElementOffset(element, 'title') || hasElementOffset(element, 'subtitle') || hasElementOffset(element, 'buttons'))" 
                                                class="absolute top-2 left-2 z-20"
                                            >
                                                <button 
                                                    @click.stop="resetAllElementOffsets(element.id)"
                                                    class="px-2 py-1 text-xs font-medium rounded bg-white/90 backdrop-blur shadow-lg border border-gray-200 text-gray-600 hover:bg-gray-100 transition-colors"
                                                    title="Reset element positions"
                                                >
                                                    Reset Positions
                                                </button>
                                            </div>
                                            
                                            <!-- Standard Flexbox Layout with Draggable Elements -->
                                            <div 
                                                class="h-full flex flex-col justify-center relative z-10"
                                                :class="[
                                                    spacing.section,
                                                    {
                                                        'text-left items-start': element.content.textPosition === 'left',
                                                        'text-center items-center': !element.content.textPosition || element.content.textPosition === 'center',
                                                        'text-right items-end': element.content.textPosition === 'right'
                                                    }
                                                ]"
                                            >
                                                <div class="w-full max-w-3xl" :class="{ 'mx-auto': !element.content.textPosition || element.content.textPosition === 'center', 'ml-auto': element.content.textPosition === 'right' }">
                                                    <!-- Draggable Title -->
                                                    <div 
                                                        class="relative group/drag"
                                                        :class="draggingElement?.sectionId === element.id && draggingElement?.elementKey === 'title' ? 'z-50' : ''"
                                                        :style="{ transform: getElementTransform(element, 'title') }"
                                                    >
                                                        <!-- Drag Handle - absolute positioned -->
                                                        <span 
                                                            class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover/drag:opacity-100 transition-opacity cursor-ns-resize bg-blue-500 text-white p-1 rounded shadow-lg z-10"
                                                            @click.stop
                                                            @mousedown.stop.prevent="startElementDrag($event, element.id, 'title')"
                                                            title="Drag to reposition vertically"
                                                        >
                                                            <ArrowsUpDownIcon class="w-3 h-3" />
                                                        </span>
                                                        <h1
                                                            v-if="isEditing(element.id, 'title')"
                                                        >
                                                            <input
                                                                v-model="editingValue"
                                                                @blur="saveInlineEdit"
                                                                @keydown="handleInlineKeydown"
                                                                class="inline-edit-input font-bold bg-white/20 border border-white/40 rounded px-3 py-2 text-white w-full"
                                                                :class="textSize.h1"
                                                            />
                                                        </h1>
                                                        <h1
                                                            v-else
                                                            @click.stop="startInlineEdit(element.id, 'title', element.content.title)"
                                                            class="font-bold text-white mb-4 cursor-pointer hover:bg-white/10 rounded px-2 py-1 transition-colors"
                                                            :class="[textSize.h1, hasElementOffset(element, 'title') ? 'ring-1 ring-blue-400/50' : '']"
                                                        >
                                                            {{ element.content.title || 'Hero Title' }}
                                                            <PencilIcon class="w-4 h-4 inline opacity-0 hover:opacity-70 ml-2" aria-hidden="true" />
                                                        </h1>
                                                    </div>
                                                    
                                                    <!-- Draggable Subtitle -->
                                                    <div 
                                                        class="relative group/drag"
                                                        :class="draggingElement?.sectionId === element.id && draggingElement?.elementKey === 'subtitle' ? 'z-50' : ''"
                                                        :style="{ transform: getElementTransform(element, 'subtitle') }"
                                                    >
                                                        <!-- Drag Handle -->
                                                        <span 
                                                            class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover/drag:opacity-100 transition-opacity cursor-ns-resize bg-blue-500 text-white p-1 rounded shadow-lg z-10"
                                                            @click.stop
                                                            @mousedown.stop.prevent="startElementDrag($event, element.id, 'subtitle')"
                                                            title="Drag to reposition vertically"
                                                        >
                                                            <ArrowsUpDownIcon class="w-3 h-3" />
                                                        </span>
                                                        <p
                                                            v-if="isEditing(element.id, 'subtitle')"
                                                        >
                                                            <input
                                                                v-model="editingValue"
                                                                @blur="saveInlineEdit"
                                                                @keydown="handleInlineKeydown"
                                                                class="inline-edit-input bg-white/20 border border-white/40 rounded px-3 py-2 text-white/90 w-full"
                                                                :class="textSize.p"
                                                            />
                                                        </p>
                                                        <p
                                                            v-else
                                                            @click.stop="startInlineEdit(element.id, 'subtitle', element.content.subtitle)"
                                                            class="text-white/90 mb-6 cursor-pointer hover:bg-white/10 rounded px-2 py-1 transition-colors"
                                                            :class="[textSize.p, hasElementOffset(element, 'subtitle') ? 'ring-1 ring-blue-400/50' : '']"
                                                        >
                                                            {{ element.content.subtitle || 'Subtitle text' }}
                                                            <PencilIcon class="w-3 h-3 inline opacity-0 hover:opacity-70 ml-2" aria-hidden="true" />
                                                        </p>
                                                    </div>
                                                    
                                                    <!-- Draggable Buttons -->
                                                    <div 
                                                        class="relative group/drag"
                                                        :class="draggingElement?.sectionId === element.id && draggingElement?.elementKey === 'buttons' ? 'z-50' : ''"
                                                        :style="{ transform: getElementTransform(element, 'buttons') }"
                                                    >
                                                        <!-- Drag Handle -->
                                                        <span 
                                                            class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover/drag:opacity-100 transition-opacity cursor-ns-resize bg-blue-500 text-white p-1 rounded shadow-lg z-10"
                                                            @click.stop
                                                            @mousedown.stop.prevent="startElementDrag($event, element.id, 'buttons')"
                                                            title="Drag to reposition vertically"
                                                        >
                                                            <ArrowsUpDownIcon class="w-3 h-3" />
                                                        </span>
                                                        <div 
                                                            :class="[
                                                                isMobilePreview ? 'flex flex-col gap-2' : 'flex flex-wrap gap-3',
                                                                {
                                                                    'justify-start': element.content.textPosition === 'left',
                                                                    'justify-center': !element.content.textPosition || element.content.textPosition === 'center',
                                                                    'justify-end': element.content.textPosition === 'right'
                                                                }
                                                            ]"
                                                        >
                                                            <button 
                                                                class="px-6 py-2 bg-white text-blue-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors" 
                                                                :class="[textSize.p, hasElementOffset(element, 'buttons') ? 'ring-1 ring-blue-400/50' : '']"
                                                            >
                                                                {{ element.content.buttonText || 'Get Started' }}
                                                            </button>
                                                            <button v-if="element.content.secondaryButtonText" class="px-6 py-2 border-2 border-white text-white font-semibold rounded-lg hover:bg-white/10 transition-colors" :class="textSize.p">
                                                                {{ element.content.secondaryButtonText }}
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Page Header Section (for inner pages) -->
                                        <div 
                                            v-else-if="element.type === 'page-header'" 
                                            class="h-full flex flex-col justify-center relative overflow-hidden"
                                            :class="[
                                                spacing.section,
                                                {
                                                    'text-left items-start': element.content.textPosition === 'left',
                                                    'text-center items-center': !element.content.textPosition || element.content.textPosition === 'center',
                                                    'text-right items-end': element.content.textPosition === 'right'
                                                }
                                            ]"
                                            :style="{ 
                                                backgroundColor: element.content.backgroundColor || '#1e40af',
                                                color: element.content.textColor || '#ffffff'
                                            }"
                                        >
                                            <div v-if="element.content.backgroundImage" class="absolute inset-0">
                                                <img :src="element.content.backgroundImage" class="w-full h-full object-cover" />
                                                <div class="absolute inset-0 bg-black/40"></div>
                                            </div>
                                            <div 
                                                class="relative z-10 w-full" 
                                                :class="{ 'mx-auto max-w-4xl': !element.content.textPosition || element.content.textPosition === 'center', 'ml-auto max-w-4xl': element.content.textPosition === 'right' }"
                                                :style="{ transform: getSectionContentTransform(element) }"
                                            >
                                                <h1
                                                    v-if="isEditing(element.id, 'title')"
                                                    class="relative inline-block w-full"
                                                >
                                                    <input
                                                        v-model="editingValue"
                                                        @blur="saveInlineEdit"
                                                        @keydown="handleInlineKeydown"
                                                        class="inline-edit-input font-bold bg-white/20 border border-white/40 rounded px-3 py-1 w-full"
                                                        :class="textSize.h2"
                                                        :style="{ color: element.content.textColor || '#ffffff' }"
                                                    />
                                                </h1>
                                                <h1
                                                    v-else
                                                    @click.stop="startInlineEdit(element.id, 'title', element.content.title)"
                                                    class="font-bold mb-2 cursor-pointer hover:bg-white/10 rounded px-2 py-1 transition-colors group/title"
                                                    :class="textSize.h2"
                                                >
                                                    {{ element.content.title || 'Page Title' }}
                                                    <PencilIcon class="w-4 h-4 inline opacity-0 group-hover/title:opacity-70 ml-2" aria-hidden="true" />
                                                </h1>
                                                <p
                                                    v-if="element.content.subtitle"
                                                    class="opacity-90 cursor-pointer hover:bg-white/10 rounded px-2 py-1 transition-colors group/sub"
                                                    :class="textSize.p"
                                                    @click.stop="startInlineEdit(element.id, 'subtitle', element.content.subtitle)"
                                                >
                                                    <template v-if="isEditing(element.id, 'subtitle')">
                                                        <input
                                                            v-model="editingValue"
                                                            @blur="saveInlineEdit"
                                                            @keydown="handleInlineKeydown"
                                                            class="inline-edit-input bg-white/20 border border-white/40 rounded px-3 py-1 w-full"
                                                            :class="textSize.p"
                                                            :style="{ color: element.content.textColor || '#ffffff' }"
                                                        />
                                                    </template>
                                                    <template v-else>
                                                        {{ element.content.subtitle }}
                                                        <PencilIcon class="w-3 h-3 inline opacity-0 group-hover/sub:opacity-70 ml-2" aria-hidden="true" />
                                                    </template>
                                                </p>
                                            </div>
                                        </div>

                                        <!-- About Section -->
                                        <div 
                                            v-else-if="element.type === 'about'" 
                                            class="h-full flex flex-col justify-center overflow-hidden"
                                            :class="spacing.section"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#ffffff',
                                                color: element.style?.textColor || '#111827'
                                            }"
                                        >
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <div 
                                                    class="flex items-center max-w-5xl mx-auto"
                                                    :class="[
                                                        isMobilePreview ? 'flex-col gap-6' : 'flex-col md:flex-row gap-8',
                                                        { 'md:flex-row-reverse': element.content.imagePosition === 'left' && !isMobilePreview }
                                                    ]"
                                                >
                                                    <div :class="element.content.image && !isMobilePreview ? 'md:w-1/2' : 'w-full'">
                                                        <h2
                                                            v-if="isEditing(element.id, 'title')"
                                                            class="relative inline-block w-full"
                                                        >
                                                            <input
                                                                v-model="editingValue"
                                                                @blur="saveInlineEdit"
                                                                @keydown="handleInlineKeydown"
                                                                class="inline-edit-input font-bold border border-blue-400 rounded px-3 py-1 text-gray-900 w-full"
                                                                :class="textSize.h2"
                                                            />
                                                        </h2>
                                                        <h2
                                                            v-else
                                                            @click.stop="startInlineEdit(element.id, 'title', element.content.title)"
                                                            class="font-bold mb-4 cursor-pointer hover:bg-gray-100 rounded px-2 py-1 transition-colors group/title"
                                                            :class="textSize.h2"
                                                        >
                                                            {{ element.content.title || 'About Us' }}
                                                            <PencilIcon class="w-4 h-4 inline opacity-0 group-hover/title:opacity-50 ml-2" aria-hidden="true" />
                                                        </h2>
                                                        <p
                                                            v-if="isEditing(element.id, 'description')"
                                                            class="relative"
                                                        >
                                                            <textarea
                                                                v-model="editingValue"
                                                                @blur="saveInlineEdit"
                                                                @keydown="handleInlineKeydown"
                                                                rows="4"
                                                                class="inline-edit-input w-full border border-blue-400 rounded px-3 py-2 text-gray-900"
                                                                :class="textSize.p"
                                                            ></textarea>
                                                        </p>
                                                        <p
                                                            v-else
                                                            @click.stop="startInlineEdit(element.id, 'description', element.content.description)"
                                                            class="text-gray-600 leading-relaxed cursor-pointer hover:bg-gray-100 rounded px-2 py-1 transition-colors group/desc"
                                                            :class="textSize.p"
                                                        >
                                                            {{ element.content.description || 'Tell your story here...' }}
                                                            <PencilIcon class="w-3 h-3 inline opacity-0 group-hover/desc:opacity-50 ml-2" aria-hidden="true" />
                                                        </p>
                                                    </div>
                                                    <div v-if="element.content.image" :class="isMobilePreview ? 'w-full' : 'md:w-1/2'">
                                                        <img :src="element.content.image" :class="isMobilePreview ? 'w-full h-48' : 'w-full h-64'" class="object-cover rounded-xl shadow-lg" />
                                                    </div>
                                                    <div v-else :class="[isMobilePreview ? 'w-full h-40' : 'md:w-1/2 h-56', 'bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl flex items-center justify-center']">
                                                        <div class="text-center">
                                                            <PhotoIcon :class="isMobilePreview ? 'w-10 h-10' : 'w-12 h-12'" class="text-blue-300 mx-auto mb-2" aria-hidden="true" />
                                                            <p class="text-blue-400 text-xs">Add an image</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Services Section -->
                                        <div 
                                            v-else-if="element.type === 'services'" 
                                            class="h-full flex flex-col justify-center overflow-hidden"
                                            :class="spacing.section"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#ffffff',
                                                color: element.style?.textColor || '#111827'
                                            }"
                                        >
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-4']">{{ element.content.title || 'Our Services' }}</h2>
                                                <p v-if="element.content.subtitle" class="text-center text-gray-600 mb-8 max-w-2xl mx-auto" :class="textSize.p">{{ element.content.subtitle }}</p>
                                                <div v-else class="mb-6"></div>
                                                <div class="grid" :class="[gridCols3, spacing.gap]">
                                                    <div v-for="(item, idx) in element.content.items || []" :key="idx" class="p-4 bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mb-3">
                                                            <Cog6ToothIcon class="w-5 h-5 text-blue-600" aria-hidden="true" />
                                                        </div>
                                                        <h3
                                                            v-if="isEditing(element.id, 'title', idx)"
                                                            class="relative"
                                                        >
                                                            <input
                                                                v-model="editingValue"
                                                                @blur="saveInlineEdit"
                                                                @keydown="handleInlineKeydown"
                                                                class="inline-edit-input font-semibold border border-blue-400 rounded px-2 py-1 w-full text-gray-900"
                                                                :class="textSize.h3"
                                                            />
                                                        </h3>
                                                        <h3
                                                            v-else
                                                            @click.stop="startInlineEdit(element.id, 'title', item.title, idx)"
                                                            class="font-semibold mb-2 cursor-pointer hover:bg-gray-100 rounded px-1 transition-colors group/item text-gray-900"
                                                            :class="textSize.h3"
                                                        >
                                                            {{ item.title }}
                                                            <PencilIcon class="w-4 h-4 inline opacity-0 group-hover/item:opacity-50 ml-1" aria-hidden="true" />
                                                        </h3>
                                                        <p class="text-gray-600 leading-relaxed" :class="textSize.p">{{ item.description }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Features Section -->
                                        <div 
                                            v-else-if="element.type === 'features'" 
                                            class="h-full flex flex-col justify-center overflow-hidden"
                                            :class="spacing.section"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#ffffff',
                                                color: element.style?.textColor || '#111827'
                                            }"
                                        >
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-4']">{{ element.content.title || 'Features' }}</h2>
                                                <p v-if="element.content.subtitle" class="text-center text-gray-600 mb-8 max-w-2xl mx-auto" :class="textSize.p">{{ element.content.subtitle }}</p>
                                                <div class="grid" :class="[gridCols2, spacing.gap]">
                                                    <div v-for="(item, idx) in element.content.items || []" :key="idx" class="flex gap-3 p-3">
                                                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                            <CheckBadgeIcon class="w-4 h-4 text-blue-600" aria-hidden="true" />
                                                        </div>
                                                        <div>
                                                            <h3 class="font-semibold mb-1" :class="textSize.p">{{ item.title }}</h3>
                                                            <p class="text-gray-600" :class="textSize.p">{{ item.description }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Gallery Section -->
                                        <div v-else-if="element.type === 'gallery'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'Gallery' }}</h2>
                                                <div class="grid gap-3" :class="isMobilePreview ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-3'">
                                                    <template v-if="element.content.images?.length">
                                                        <div v-for="(img, idx) in element.content.images" :key="img.id || idx" class="aspect-square rounded-lg overflow-hidden">
                                                            <img :src="img.url" :alt="img.alt || ''" class="w-full h-full object-cover hover:scale-105 transition-transform" />
                                                        </div>
                                                    </template>
                                                    <template v-else>
                                                        <div v-for="n in 6" :key="n" class="aspect-square bg-gray-200 rounded-lg flex items-center justify-center">
                                                            <PhotoIcon class="w-8 h-8 text-gray-400" aria-hidden="true" />
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Testimonials Section -->
                                        <div 
                                            v-else-if="element.type === 'testimonials'" 
                                            class="h-full flex flex-col justify-center py-16 px-8 overflow-hidden"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#f8fafc',
                                                color: element.style?.textColor || '#111827'
                                            }"
                                        >
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'Testimonials' }}</h2>
                                                <div class="grid" :class="[gridCols2, spacing.gap]">
                                                    <div v-for="(item, idx) in element.content.items || []" :key="idx" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100">
                                                        <p class="text-gray-600 italic mb-3" :class="textSize.p">"{{ item.text }}"</p>
                                                        <div class="flex items-center gap-2">
                                                            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                                                {{ item.name?.charAt(0) || 'A' }}
                                                            </div>
                                                            <div>
                                                                <p class="font-semibold text-gray-900" :class="textSize.p">{{ item.name }}</p>
                                                                <p class="text-gray-500 text-xs">{{ item.role }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pricing Section -->
                                        <div v-else-if="element.type === 'pricing'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'Pricing' }}</h2>
                                                <div class="grid" :class="[gridCols3, spacing.gap]">
                                                    <div v-for="(plan, idx) in element.content.plans || []" :key="idx" class="p-4 bg-white border border-gray-200 rounded-xl text-center">
                                                        <h3 class="font-semibold mb-2" :class="textSize.h3">{{ plan.name }}</h3>
                                                        <p class="font-bold text-blue-600 mb-4" :class="isMobilePreview ? 'text-2xl' : 'text-3xl'">{{ plan.price }}</p>
                                                        <ul class="space-y-1 mb-4">
                                                            <li v-for="(feature, fIdx) in plan.features || []" :key="fIdx" class="text-gray-600" :class="textSize.p">{{ feature }}</li>
                                                        </ul>
                                                        <button class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" :class="textSize.p">Choose Plan</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Products Section -->
                                        <div v-else-if="element.type === 'products'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'Products' }}</h2>
                                                <div class="grid gap-4" :class="isMobilePreview ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-3'">
                                                    <div v-for="n in 6" :key="n" class="bg-white border border-gray-200 rounded-xl overflow-hidden">
                                                        <div class="aspect-square bg-gray-100 flex items-center justify-center">
                                                            <ShoppingBagIcon class="w-8 h-8 text-gray-300" aria-hidden="true" />
                                                        </div>
                                                        <div class="p-3">
                                                            <h3 class="font-semibold" :class="textSize.p">Product {{ n }}</h3>
                                                            <p class="text-blue-600 font-bold">K99.00</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Contact Section -->
                                        <div 
                                            v-else-if="element.type === 'contact'" 
                                            class="h-full flex flex-col justify-center"
                                            :class="spacing.section"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#ffffff',
                                                color: element.style?.textColor || '#111827'
                                            }"
                                        >
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-3']">{{ element.content.title || 'Contact Us' }}</h2>
                                                <p class="text-center text-gray-600 mb-6 max-w-xl mx-auto" :class="textSize.p">{{ element.content.description || 'Get in touch with our team' }}</p>
                                                <div class="max-w-lg mx-auto w-full">
                                                    <div class="bg-white rounded-xl shadow-lg border border-gray-100" :class="isMobilePreview ? 'p-4' : 'p-6'">
                                                        <div :class="isMobilePreview ? 'space-y-3' : 'space-y-4'">
                                                            <div :class="isMobilePreview ? 'space-y-3' : 'grid grid-cols-2 gap-4'">
                                                                <input type="text" placeholder="First Name" class="w-full border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" :class="isMobilePreview ? 'px-3 py-2 text-sm' : 'px-4 py-3'" />
                                                                <input type="text" placeholder="Last Name" class="w-full border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" :class="isMobilePreview ? 'px-3 py-2 text-sm' : 'px-4 py-3'" />
                                                            </div>
                                                            <input type="email" placeholder="Email Address" class="w-full border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" :class="isMobilePreview ? 'px-3 py-2 text-sm' : 'px-4 py-3'" />
                                                            <input type="tel" placeholder="Phone Number" class="w-full border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" :class="isMobilePreview ? 'px-3 py-2 text-sm' : 'px-4 py-3'" />
                                                            <textarea placeholder="How can we help you?" :rows="isMobilePreview ? 3 : 4" class="w-full border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" :class="isMobilePreview ? 'px-3 py-2 text-sm' : 'px-4 py-3'"></textarea>
                                                            <button class="w-full bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors" :class="isMobilePreview ? 'py-2 text-sm' : 'py-3'">
                                                                Send Message
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- CTA Section -->
                                        <div 
                                            v-else-if="element.type === 'cta'" 
                                            class="h-full relative overflow-hidden"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#2563eb',
                                                color: element.style?.textColor || '#ffffff',
                                                minHeight: isMobilePreview ? '200px' : '250px'
                                            }"
                                        >
                                            <!-- Reset Button (shows when any element has been moved) -->
                                            <div 
                                                v-if="selectedSectionId === element.id && (hasElementOffset(element, 'title') || hasElementOffset(element, 'description') || hasElementOffset(element, 'button'))" 
                                                class="absolute top-2 left-2 z-20"
                                            >
                                                <button 
                                                    @click.stop="resetAllElementOffsets(element.id)"
                                                    class="px-2 py-1 text-xs font-medium rounded bg-white/90 backdrop-blur shadow-lg border border-gray-200 text-gray-600 hover:bg-gray-100 transition-colors"
                                                    title="Reset element positions"
                                                >
                                                    Reset Positions
                                                </button>
                                            </div>
                                            
                                            <!-- Standard Layout with Draggable Elements -->
                                            <div 
                                                class="h-full flex flex-col justify-center items-center text-center max-w-xl mx-auto"
                                                :class="spacing.section"
                                            >
                                                <!-- Draggable Title -->
                                                <div 
                                                    class="relative group/drag w-full"
                                                    :class="draggingElement?.sectionId === element.id && draggingElement?.elementKey === 'title' ? 'z-50' : ''"
                                                    :style="{ transform: getElementTransform(element, 'title') }"
                                                >
                                                    <!-- Drag Handle -->
                                                    <span 
                                                        class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover/drag:opacity-100 transition-opacity cursor-ns-resize bg-white/90 text-gray-700 p-1 rounded shadow-lg z-10"
                                                        @click.stop
                                                        @mousedown.stop.prevent="startElementDrag($event, element.id, 'title')"
                                                        title="Drag to reposition vertically"
                                                    >
                                                        <ArrowsUpDownIcon class="w-3 h-3" />
                                                    </span>
                                                    <h2 
                                                        :class="[textSize.h2, 'font-bold mb-3', hasElementOffset(element, 'title') ? 'ring-1 ring-white/50' : '']"
                                                    >
                                                        {{ element.content.title || 'Ready to Get Started?' }}
                                                    </h2>
                                                </div>
                                                
                                                <!-- Draggable Description -->
                                                <div 
                                                    class="relative group/drag w-full"
                                                    :class="draggingElement?.sectionId === element.id && draggingElement?.elementKey === 'description' ? 'z-50' : ''"
                                                    :style="{ transform: getElementTransform(element, 'description') }"
                                                >
                                                    <!-- Drag Handle -->
                                                    <span 
                                                        class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover/drag:opacity-100 transition-opacity cursor-ns-resize bg-white/90 text-gray-700 p-1 rounded shadow-lg z-10"
                                                        @click.stop
                                                        @mousedown.stop.prevent="startElementDrag($event, element.id, 'description')"
                                                        title="Drag to reposition vertically"
                                                    >
                                                        <ArrowsUpDownIcon class="w-3 h-3" />
                                                    </span>
                                                    <p 
                                                        class="opacity-90 mb-6" 
                                                        :class="[textSize.p, hasElementOffset(element, 'description') ? 'ring-1 ring-white/50' : '']"
                                                    >
                                                        {{ element.content.description || 'Contact us today' }}
                                                    </p>
                                                </div>
                                                
                                                <!-- Draggable Button -->
                                                <div 
                                                    class="relative group/drag"
                                                    :class="draggingElement?.sectionId === element.id && draggingElement?.elementKey === 'button' ? 'z-50' : ''"
                                                    :style="{ transform: getElementTransform(element, 'button') }"
                                                >
                                                    <!-- Drag Handle -->
                                                    <span 
                                                        class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover/drag:opacity-100 transition-opacity cursor-ns-resize bg-white/90 text-gray-700 p-1 rounded shadow-lg z-10"
                                                        @click.stop
                                                        @mousedown.stop.prevent="startElementDrag($event, element.id, 'button')"
                                                        title="Drag to reposition vertically"
                                                    >
                                                        <ArrowsUpDownIcon class="w-3 h-3" />
                                                    </span>
                                                    <button 
                                                        class="bg-white text-gray-900 font-semibold rounded-lg hover:bg-gray-100 transition-colors" 
                                                        :class="[isMobilePreview ? 'px-6 py-2 text-sm' : 'px-8 py-3', hasElementOffset(element, 'button') ? 'ring-1 ring-white/50' : '']"
                                                    >
                                                        {{ element.content.buttonText || 'Contact Us' }}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Text Section -->
                                        <div v-else-if="element.type === 'text'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <div class="prose max-w-none" :class="isMobilePreview ? 'prose-sm' : ''" v-html="element.content.content || '<p>Enter your text here...</p>'"></div>
                                            </div>
                                        </div>

                                        <!-- FAQ Section -->
                                        <div v-else-if="element.type === 'faq'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'FAQ' }}</h2>
                                                <div class="max-w-2xl mx-auto space-y-3">
                                                    <div v-for="(item, idx) in element.content.items || []" :key="idx" class="border border-gray-200 rounded-lg overflow-hidden">
                                                        <div class="p-3 bg-gray-50 font-semibold flex items-center justify-between" :class="textSize.p">
                                                            <span>{{ item.question }}</span>
                                                            <ChevronDownIcon class="w-4 h-4 text-gray-400 flex-shrink-0" aria-hidden="true" />
                                                        </div>
                                                        <div class="p-3 text-gray-600" :class="textSize.p">{{ item.answer }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Team Section -->
                                        <div v-else-if="element.type === 'team'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'Our Team' }}</h2>
                                                <div class="grid" :class="[gridCols4, spacing.gap]">
                                                    <div v-for="(member, idx) in element.content.items || []" :key="idx" class="text-center">
                                                        <div :class="isMobilePreview ? 'w-16 h-16' : 'w-20 h-20'" class="mx-auto mb-3 rounded-full overflow-hidden bg-gray-200">
                                                            <img v-if="member.image" :src="member.image" class="w-full h-full object-cover" :alt="member.name" />
                                                            <UserGroupIcon v-else class="w-8 h-8 m-4 text-gray-400" aria-hidden="true" />
                                                        </div>
                                                        <h3 class="font-semibold" :class="textSize.p">{{ member.name }}</h3>
                                                        <p class="text-gray-500 text-xs">{{ member.role }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Blog Section -->
                                        <div v-else-if="element.type === 'blog'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title || 'Latest News' }}</h2>
                                                <div class="grid" :class="[gridCols3, spacing.gap]">
                                                    <div v-for="(post, idx) in element.content.posts || []" :key="idx" class="bg-white border border-gray-200 rounded-xl overflow-hidden">
                                                        <div class="aspect-video bg-gray-100 flex items-center justify-center">
                                                            <img v-if="post.image" :src="post.image" class="w-full h-full object-cover" :alt="post.title" />
                                                            <NewspaperIcon v-else class="w-8 h-8 text-gray-300" aria-hidden="true" />
                                                        </div>
                                                        <div class="p-3">
                                                            <p class="text-xs text-gray-500 mb-1">{{ post.date }}</p>
                                                            <h3 class="font-semibold mb-1" :class="textSize.p">{{ post.title }}</h3>
                                                            <p class="text-gray-600 text-xs line-clamp-2">{{ post.excerpt }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Stats Section -->
                                        <div 
                                            v-else-if="element.type === 'stats'" 
                                            class="h-full flex flex-col justify-center overflow-hidden"
                                            :class="spacing.section"
                                            :style="{ 
                                                backgroundColor: element.style?.backgroundColor || '#2563eb',
                                                color: element.style?.textColor || '#ffffff'
                                            }"
                                        >
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 v-if="element.content.title" :class="[textSize.h2, 'font-bold text-center mb-8']">{{ element.content.title }}</h2>
                                                <div class="grid text-center" :class="[gridCols4, spacing.gap]">
                                                    <div v-for="(stat, idx) in element.content.items || []" :key="idx">
                                                        <p class="font-bold mb-1" :class="isMobilePreview ? 'text-2xl' : 'text-4xl'">{{ stat.value }}</p>
                                                        <p class="opacity-80" :class="textSize.p">{{ stat.label }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Map Section -->
                                        <div v-else-if="element.type === 'map'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 v-if="element.content.title" :class="[textSize.h2, 'font-bold text-center mb-6']">{{ element.content.title }}</h2>
                                                <div class="aspect-video bg-gray-200 rounded-xl flex items-center justify-center">
                                                    <iframe v-if="element.content.embedUrl" :src="element.content.embedUrl" class="w-full h-full rounded-xl" frameborder="0" allowfullscreen></iframe>
                                                    <div v-else class="text-center">
                                                        <MapPinIcon :class="isMobilePreview ? 'w-10 h-10' : 'w-14 h-14'" class="mx-auto text-gray-400 mb-3" aria-hidden="true" />
                                                        <p class="text-gray-500" :class="textSize.p">Add a Google Maps embed URL</p>
                                                    </div>
                                                </div>
                                                <p v-if="element.content.showAddress && element.content.address" class="text-center mt-3 text-gray-600" :class="textSize.p">
                                                    <MapPinIcon class="w-4 h-4 inline mr-1" aria-hidden="true" />
                                                    {{ element.content.address }}
                                                </p>
                                            </div>
                                        </div>

                                        <!-- Video Section -->
                                        <div v-else-if="element.type === 'video'" class="h-full flex flex-col justify-center overflow-hidden" :class="spacing.section" :style="{ color: element.style?.textColor || '#111827' }">
                                            <div :style="{ transform: getSectionContentTransform(element) }">
                                                <h2 v-if="element.content.title" :class="[textSize.h2, 'font-bold text-center mb-3']">{{ element.content.title }}</h2>
                                                <p v-if="element.content.description" class="text-center text-gray-600 mb-6" :class="textSize.p">{{ element.content.description }}</p>
                                                <div class="aspect-video bg-gray-900 rounded-xl flex items-center justify-center max-w-3xl mx-auto w-full">
                                                    <iframe v-if="element.content.videoUrl" :src="element.content.videoUrl" class="w-full h-full rounded-xl" frameborder="0" allowfullscreen></iframe>
                                                    <div v-else class="text-center">
                                                        <PlayCircleIcon :class="isMobilePreview ? 'w-12 h-12' : 'w-16 h-16'" class="mx-auto text-gray-600 mb-3" aria-hidden="true" />
                                                        <p class="text-gray-400" :class="textSize.p">Add a video URL</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Divider Section -->
                                        <div v-else-if="element.type === 'divider'" class="flex items-center justify-center" :style="{ height: `${element.content.height || 40}px` }">
                                            <div v-if="element.content.style === 'line'" class="w-full border-t" :style="{ borderColor: element.content.color || '#e5e7eb' }"></div>
                                            <div v-else-if="element.content.style === 'dots'" class="flex gap-2">
                                                <span v-for="n in 3" :key="n" class="w-2 h-2 rounded-full" :style="{ backgroundColor: element.content.color || '#e5e7eb' }"></span>
                                            </div>
                                            <!-- space style is just empty space -->
                                        </div>

                                        <!-- Default/Unknown Section -->
                                        <div v-else class="h-full flex flex-col justify-center items-center text-center text-gray-500" :class="spacing.section">
                                            <Squares2X2Icon :class="isMobilePreview ? 'w-8 h-8' : 'w-12 h-12'" class="mx-auto mb-3 text-gray-300" aria-hidden="true" />
                                            <p :class="textSize.p">{{ element.type }} section</p>
                                        </div>
                                    </div>

                                    <!-- Resize Handle -->
                                    <div
                                        v-if="hoveredSectionId === element.id || selectedSectionId === element.id || resizingSection === element.id"
                                        class="absolute bottom-0 left-0 right-0 h-3 flex items-center justify-center cursor-ns-resize group/resize z-20 hover:bg-blue-100/50 transition-colors"
                                        @mousedown="startResize($event, element.id)"
                                    >
                                        <div class="w-12 h-1 bg-gray-300 rounded-full group-hover/resize:bg-blue-500 transition-colors"></div>
                                    </div>
                                </div>
                            </template>
                        </draggable>

                        <!-- Empty State -->
                        <div v-if="sections.length === 0 && !isDragging" class="min-h-[400px] flex flex-col items-center justify-center p-12">
                            <div class="w-20 h-20 bg-gray-100 rounded-2xl flex items-center justify-center mb-6">
                                <Squares2X2Icon class="w-10 h-10 text-gray-400" aria-hidden="true" />
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Start building your page</h3>
                            <p class="text-gray-500 text-center mb-6">Drag widgets from the left panel or click below to add sections</p>
                            <button @click="showAddSectionPanel = true" class="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                                <PlusIcon class="w-5 h-5" aria-hidden="true" />
                                Add Section
                            </button>
                        </div>

                        <!-- Site-Wide Footer (appears on all pages) -->
                        <div 
                            class="relative group cursor-pointer"
                            :class="showFooterSettings ? 'ring-2 ring-blue-500 ring-inset' : 'hover:ring-1 hover:ring-blue-300 hover:ring-inset'"
                            @click="showFooterSettings = true; showNavSettings = false; selectedSectionId = null"
                        >
                            <!-- Footer Edit Indicator -->
                            <div v-if="showFooterSettings" class="absolute top-2 right-2 z-10 flex items-center gap-1 bg-white rounded-lg shadow-lg border border-gray-200 p-1">
                                <span class="text-xs text-blue-600 font-medium px-2">Editing Footer</span>
                            </div>
                            <div 
                                class="px-8 transition-all"
                                :class="{
                                    'py-12': !siteFooter.layout || siteFooter.layout === 'columns' || siteFooter.layout === 'stacked' || siteFooter.layout === 'split' || siteFooter.layout === 'social',
                                    'py-10': siteFooter.layout === 'newsletter' || siteFooter.layout === 'contact',
                                    'py-8': siteFooter.layout === 'centered',
                                    'py-4': siteFooter.layout === 'minimal'
                                }"
                                :style="{ backgroundColor: siteFooter.backgroundColor, color: siteFooter.textColor }"
                            >
                                <div class="max-w-4xl mx-auto">
                                    <!-- Columns Layout (default) -->
                                    <template v-if="!siteFooter.layout || siteFooter.layout === 'columns'">
                                        <div v-if="siteFooter.columns.length > 0" class="grid gap-8 mb-8" :style="{ gridTemplateColumns: `repeat(${Math.min(siteFooter.columns.length + 1, 4)}, 1fr)` }">
                                            <div>
                                                <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-10 object-contain mb-4" alt="Logo" />
                                                <h3 v-else class="font-bold text-lg mb-4">{{ siteNavigation.logoText || site.name }}</h3>
                                                <p class="text-sm opacity-80">Your trusted partner for growth and success.</p>
                                            </div>
                                            <div v-for="column in siteFooter.columns" :key="column.id">
                                                <h4 class="font-semibold mb-3">{{ column.title }}</h4>
                                                <ul class="space-y-2">
                                                    <li v-for="link in column.links" :key="link.id">
                                                        <span class="text-sm opacity-80 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                    </li>
                                                    <li v-if="column.links.length === 0" class="text-sm opacity-50 italic">No links yet</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center gap-4 mb-6">
                                            <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-8 h-8 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                <span class="text-xs uppercase">{{ social.platform.charAt(0) }}</span>
                                            </span>
                                        </div>
                                        <div class="pt-6 border-t border-white/20 text-center">
                                            <p class="text-sm opacity-70">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>

                                    <!-- Centered Layout -->
                                    <template v-else-if="siteFooter.layout === 'centered'">
                                        <div class="text-center">
                                            <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-10 object-contain mx-auto mb-4" alt="Logo" />
                                            <h3 v-else class="font-bold text-xl mb-4">{{ siteNavigation.logoText || site.name }}</h3>
                                            <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center justify-center gap-4 mb-6">
                                                <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                    <span class="text-sm uppercase">{{ social.platform.charAt(0) }}</span>
                                                </span>
                                            </div>
                                            <div class="flex flex-wrap items-center justify-center gap-6 mb-6">
                                                <template v-for="column in siteFooter.columns" :key="column.id">
                                                    <span v-for="link in column.links" :key="link.id" class="text-sm opacity-80 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                </template>
                                            </div>
                                            <p class="text-sm opacity-70">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>

                                    <!-- Minimal Layout -->
                                    <template v-else-if="siteFooter.layout === 'minimal'">
                                        <div class="flex items-center justify-between">
                                            <p class="text-sm opacity-70">{{ siteFooter.copyrightText }}</p>
                                            <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center gap-3">
                                                <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-6 h-6 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                    <span class="text-xs uppercase">{{ social.platform.charAt(0) }}</span>
                                                </span>
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Stacked Layout -->
                                    <template v-else-if="siteFooter.layout === 'stacked'">
                                        <div class="text-center mb-8">
                                            <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-12 object-contain mx-auto mb-4" alt="Logo" />
                                            <h3 v-else class="font-bold text-2xl mb-2">{{ siteNavigation.logoText || site.name }}</h3>
                                            <p class="text-sm opacity-80 max-w-md mx-auto">Your trusted partner for growth and success.</p>
                                        </div>
                                        <div v-if="siteFooter.columns.length > 0" class="grid gap-8 mb-8" :style="{ gridTemplateColumns: `repeat(${Math.min(siteFooter.columns.length, 4)}, 1fr)` }">
                                            <div v-for="column in siteFooter.columns" :key="column.id" class="text-center">
                                                <h4 class="font-semibold mb-3">{{ column.title }}</h4>
                                                <ul class="space-y-2">
                                                    <li v-for="link in column.links" :key="link.id">
                                                        <span class="text-sm opacity-80 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center justify-center gap-4 mb-6">
                                            <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                <span class="text-sm uppercase">{{ social.platform.charAt(0) }}</span>
                                            </span>
                                        </div>
                                        <div class="pt-6 border-t border-white/20 text-center">
                                            <p class="text-sm opacity-70">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>

                                    <!-- Split Layout - Brand left, links right -->
                                    <template v-else-if="siteFooter.layout === 'split'">
                                        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-8">
                                            <!-- Left: Brand Info -->
                                            <div class="md:w-1/3">
                                                <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-10 object-contain mb-4" alt="Logo" />
                                                <h3 v-else class="font-bold text-xl mb-3">{{ siteNavigation.logoText || site.name }}</h3>
                                                <p class="text-sm opacity-80 mb-4">Your trusted partner for growth and success in Zambia.</p>
                                                <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center gap-3">
                                                    <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-8 h-8 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                        <span class="text-xs uppercase">{{ social.platform.charAt(0) }}</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <!-- Right: Links -->
                                            <div class="md:w-2/3 flex flex-wrap gap-8 justify-end">
                                                <div v-for="column in siteFooter.columns" :key="column.id">
                                                    <h4 class="font-semibold mb-3 text-sm uppercase tracking-wider opacity-90">{{ column.title }}</h4>
                                                    <ul class="space-y-2">
                                                        <li v-for="link in column.links" :key="link.id">
                                                            <span class="text-sm opacity-70 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-8 pt-6 border-t border-white/20 text-center md:text-left">
                                            <p class="text-sm opacity-60">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>

                                    <!-- Newsletter Layout - Email signup focus -->
                                    <template v-else-if="siteFooter.layout === 'newsletter'">
                                        <div class="text-center max-w-xl mx-auto">
                                            <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-10 object-contain mx-auto mb-4" alt="Logo" />
                                            <h3 v-else class="font-bold text-xl mb-2">{{ siteNavigation.logoText || site.name }}</h3>
                                            <p class="text-sm opacity-80 mb-6">Stay updated with our latest news and offers. Subscribe to our newsletter.</p>
                                            <!-- Newsletter Form Preview -->
                                            <div class="flex gap-2 max-w-md mx-auto mb-6">
                                                <input 
                                                    type="email" 
                                                    placeholder="Enter your email" 
                                                    class="flex-1 px-4 py-2 rounded-lg text-gray-900 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    disabled
                                                />
                                                <button class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                                                    Subscribe
                                                </button>
                                            </div>
                                            <!-- Minimal Links -->
                                            <div class="flex flex-wrap items-center justify-center gap-4 mb-6">
                                                <template v-for="column in siteFooter.columns" :key="column.id">
                                                    <span v-for="link in column.links" :key="link.id" class="text-sm opacity-70 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                </template>
                                            </div>
                                            <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center justify-center gap-3 mb-4">
                                                <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-8 h-8 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                    <span class="text-xs uppercase">{{ social.platform.charAt(0) }}</span>
                                                </span>
                                            </div>
                                            <p class="text-xs opacity-50">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>

                                    <!-- Social Focus Layout - Large social icons -->
                                    <template v-else-if="siteFooter.layout === 'social'">
                                        <div class="text-center">
                                            <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-12 object-contain mx-auto mb-4" alt="Logo" />
                                            <h3 v-else class="font-bold text-2xl mb-2">{{ siteNavigation.logoText || site.name }}</h3>
                                            <p class="text-sm opacity-80 mb-8 max-w-md mx-auto">Connect with us on social media</p>
                                            <!-- Large Social Icons -->
                                            <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center justify-center gap-6 mb-8">
                                                <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center hover:bg-white/20 hover:scale-110 cursor-pointer transition-all">
                                                    <span class="text-lg font-bold uppercase">{{ social.platform.charAt(0) }}</span>
                                                </span>
                                            </div>
                                            <div v-else class="flex items-center justify-center gap-6 mb-8">
                                                <span class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center">
                                                    <span class="text-lg font-bold">F</span>
                                                </span>
                                                <span class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center">
                                                    <span class="text-lg font-bold">T</span>
                                                </span>
                                                <span class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center">
                                                    <span class="text-lg font-bold">I</span>
                                                </span>
                                                <span class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center">
                                                    <span class="text-lg font-bold">L</span>
                                                </span>
                                            </div>
                                            <!-- Minimal Links Row -->
                                            <div class="flex flex-wrap items-center justify-center gap-6 mb-4">
                                                <template v-for="column in siteFooter.columns" :key="column.id">
                                                    <span v-for="link in column.links" :key="link.id" class="text-sm opacity-70 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                </template>
                                            </div>
                                            <p class="text-sm opacity-50">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>

                                    <!-- Contact Bar Layout - Phone, email, address prominent -->
                                    <template v-else-if="siteFooter.layout === 'contact'">
                                        <!-- Contact Info Bar -->
                                        <div class="flex flex-wrap items-center justify-center gap-8 mb-6 pb-6 border-b border-white/20">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center">
                                                    <span class="text-sm">📞</span>
                                                </div>
                                                <div>
                                                    <p class="text-xs opacity-60 uppercase tracking-wider">Call Us</p>
                                                    <p class="text-sm font-medium">+260 97X XXX XXX</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center">
                                                    <span class="text-sm">✉️</span>
                                                </div>
                                                <div>
                                                    <p class="text-xs opacity-60 uppercase tracking-wider">Email</p>
                                                    <p class="text-sm font-medium">info@example.com</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center">
                                                    <span class="text-sm">📍</span>
                                                </div>
                                                <div>
                                                    <p class="text-xs opacity-60 uppercase tracking-wider">Location</p>
                                                    <p class="text-sm font-medium">Lusaka, Zambia</p>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Bottom Row -->
                                        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                                            <div class="flex items-center gap-4">
                                                <img v-if="siteFooter.logo" :src="siteFooter.logo" class="h-8 object-contain" alt="Logo" />
                                                <span v-else class="font-bold">{{ siteNavigation.logoText || site.name }}</span>
                                            </div>
                                            <div class="flex flex-wrap items-center justify-center gap-4">
                                                <template v-for="column in siteFooter.columns" :key="column.id">
                                                    <span v-for="link in column.links" :key="link.id" class="text-sm opacity-70 hover:opacity-100 cursor-pointer">{{ link.label }}</span>
                                                </template>
                                            </div>
                                            <div v-if="siteFooter.showSocialLinks && siteFooter.socialLinks.length > 0" class="flex items-center gap-2">
                                                <span v-for="social in siteFooter.socialLinks" :key="social.id" class="w-8 h-8 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 cursor-pointer">
                                                    <span class="text-xs uppercase">{{ social.platform.charAt(0) }}</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="mt-4 pt-4 border-t border-white/10 text-center">
                                            <p class="text-xs opacity-50">{{ siteFooter.copyrightText }}</p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div class="absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/5 transition-colors">
                                <span class="opacity-0 group-hover:opacity-100 text-xs bg-blue-600 text-white px-2 py-1 rounded transition-opacity">
                                    Click to edit footer
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar - Inspector -->
            <aside :class="['bg-white border-l border-gray-200 flex flex-col transition-all duration-300 flex-shrink-0', rightSidebarOpen ? 'w-80' : 'w-0']">
                <div v-if="rightSidebarOpen" class="flex flex-col h-full overflow-hidden">
                    <!-- Inspector Header -->
                    <div class="p-4 border-b border-gray-200">
                        <!-- Navigation Settings Header -->
                        <div v-if="showNavSettings" class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                                <Bars3BottomLeftIcon class="w-5 h-5 text-indigo-600" aria-hidden="true" />
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">Site Navigation</h3>
                                <p class="text-xs text-gray-500">Appears on all pages</p>
                            </div>
                        </div>
                        <!-- Footer Settings Header -->
                        <div v-else-if="showFooterSettings" class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-700 rounded-lg flex items-center justify-center">
                                <Bars3BottomLeftIcon class="w-5 h-5 text-white" aria-hidden="true" />
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">Site Footer</h3>
                                <p class="text-xs text-gray-500">Appears on all pages</p>
                            </div>
                        </div>
                        <!-- Section Header -->
                        <div v-else-if="selectedSection" class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <component :is="selectedSectionType?.icon || Squares2X2Icon" class="w-5 h-5 text-blue-600" aria-hidden="true" />
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900 capitalize">{{ selectedSection.type }}</h3>
                                <p class="text-xs text-gray-500">Edit section properties</p>
                            </div>
                        </div>
                        <div v-else class="text-center py-4">
                            <p class="text-gray-500 text-sm">Select a section to edit</p>
                        </div>
                    </div>

                    <!-- Navigation Settings Panel -->
                    <div v-if="showNavSettings" class="flex-1 overflow-y-auto p-4 space-y-4">
                        <!-- Logo Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Logo</label>
                            <div v-if="siteNavigation.logo" class="relative mb-2">
                                <img :src="siteNavigation.logo" class="h-12 object-contain rounded border border-gray-200 bg-gray-50 p-1" />
                                <button @click="siteNavigation.logo = ''" class="absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                    <XMarkIcon class="w-3 h-3" aria-hidden="true" />
                                </button>
                            </div>
                            <button
                                @click="openMediaLibrary('navigation', 'logo')"
                                class="w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-400 hover:text-blue-600 transition-colors"
                            >
                                <PhotoIcon class="w-5 h-5" aria-hidden="true" />
                                <span class="text-sm">{{ siteNavigation.logo ? 'Change Logo' : 'Upload Logo' }}</span>
                            </button>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Logo Text (fallback)</label>
                            <input
                                v-model="siteNavigation.logoText"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                placeholder="Your Business Name"
                            />
                            <p class="text-xs text-gray-400 mt-1">Shown when no logo image is set</p>
                        </div>
                        
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-sm font-medium text-gray-700">Navigation Links</label>
                                <button @click="siteNavigation.navItems.push({ id: `nav-${Date.now()}`, label: 'New Link', url: '#', pageId: null, isExternal: false, children: [] })" class="text-xs text-blue-600 hover:text-blue-700">+ Add Link</button>
                            </div>
                            <div class="space-y-2">
                                <div v-for="(navItem, idx) in siteNavigation.navItems" :key="navItem.id || idx" class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <input
                                            v-model="navItem.label"
                                            placeholder="Label"
                                            class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                        />
                                        <button @click="siteNavigation.navItems.splice(idx, 1)" class="p-1 hover:bg-red-100 rounded">
                                            <TrashIcon class="w-4 h-4 text-red-500" aria-hidden="true" />
                                        </button>
                                    </div>
                                    <select
                                        :value="navItem.pageId"
                                        @change="(e) => {
                                            const pageId = (e.target as HTMLSelectElement).value ? parseInt((e.target as HTMLSelectElement).value) : null;
                                            navItem.pageId = pageId;
                                            if (pageId) {
                                                const page = pages.find(p => p.id === pageId);
                                                if (page) {
                                                    navItem.label = page.title;
                                                    navItem.url = page.isHomepage ? '/' : `/${page.slug}`;
                                                }
                                            }
                                        }"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900 mb-2"
                                    >
                                        <option :value="null">Custom URL</option>
                                        <option v-for="page in pages" :key="page.id" :value="page.id">{{ page.title }}</option>
                                    </select>
                                    <input
                                        v-if="!navItem.pageId"
                                        v-model="navItem.url"
                                        placeholder="URL (e.g., #contact)"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                    />
                                </div>
                                <div v-if="siteNavigation.navItems.length === 0" class="text-center py-4 text-gray-400 text-sm">
                                    No navigation links yet
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Call to Action Button</h4>
                            <div class="flex items-center gap-2 mb-3">
                                <input v-model="siteNavigation.showCta" type="checkbox" id="showCta" class="rounded border-gray-300" />
                                <label for="showCta" class="text-sm text-gray-700">Show CTA button</label>
                            </div>
                            <div v-if="siteNavigation.showCta" class="space-y-3">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Button Text</label>
                                    <input
                                        v-model="siteNavigation.ctaText"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                        placeholder="Contact Us"
                                    />
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Button Link</label>
                                    <input
                                        v-model="siteNavigation.ctaLink"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                        placeholder="#contact"
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex items-center gap-2 mb-4">
                                <input v-model="siteNavigation.sticky" type="checkbox" id="stickyNav" class="rounded border-gray-300" />
                                <label for="stickyNav" class="text-sm text-gray-700">Sticky navigation</label>
                            </div>
                            
                            <!-- Navigation Style -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Navigation Style</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button
                                        @click="siteNavigation.style = 'default'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'default' || !siteNavigation.style ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Default</div>
                                        <div class="text-xs text-gray-500">Clean & simple</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'centered'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'centered' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Centered</div>
                                        <div class="text-xs text-gray-500">Logo in middle</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'split'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'split' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Split</div>
                                        <div class="text-xs text-gray-500">Links both sides</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'floating'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'floating' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Floating</div>
                                        <div class="text-xs text-gray-500">Rounded & shadow</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'transparent'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'transparent' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Transparent</div>
                                        <div class="text-xs text-gray-500">Overlay on hero</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'dark'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'dark' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Dark</div>
                                        <div class="text-xs text-gray-500">Dark background</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'sidebar'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'sidebar' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Sidebar</div>
                                        <div class="text-xs text-gray-500">Hamburger menu</div>
                                    </button>
                                    <button
                                        @click="siteNavigation.style = 'mega'"
                                        :class="[
                                            'p-3 border-2 rounded-lg text-left transition-all',
                                            siteNavigation.style === 'mega' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                        ]"
                                    >
                                        <div class="text-xs font-medium text-gray-900">Mega Menu</div>
                                        <div class="text-xs text-gray-500">Dropdown columns</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Settings Panel -->
                    <div v-else-if="showFooterSettings" class="flex-1 overflow-y-auto p-4 space-y-4">
                        <!-- Footer Layout Style -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Footer Layout</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button
                                    @click="siteFooter.layout = 'columns'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'columns' || !siteFooter.layout ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Columns</div>
                                    <div class="text-xs text-gray-500">Multi-column layout</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'centered'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'centered' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Centered</div>
                                    <div class="text-xs text-gray-500">Simple centered</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'split'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'split' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Split</div>
                                    <div class="text-xs text-gray-500">Brand left, links right</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'minimal'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'minimal' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Minimal</div>
                                    <div class="text-xs text-gray-500">Just copyright</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'stacked'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'stacked' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Stacked</div>
                                    <div class="text-xs text-gray-500">Vertical sections</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'newsletter'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'newsletter' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Newsletter</div>
                                    <div class="text-xs text-gray-500">Email signup focus</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'social'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'social' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Social Focus</div>
                                    <div class="text-xs text-gray-500">Large social icons</div>
                                </button>
                                <button
                                    @click="siteFooter.layout = 'contact'"
                                    :class="[
                                        'p-3 border-2 rounded-lg text-left transition-all',
                                        siteFooter.layout === 'contact' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                                    ]"
                                >
                                    <div class="text-xs font-medium text-gray-900">Contact Bar</div>
                                    <div class="text-xs text-gray-500">Phone, email, address</div>
                                </button>
                            </div>
                        </div>

                        <!-- Footer Logo Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Footer Logo</label>
                            <div v-if="siteFooter.logo" class="relative mb-2">
                                <img :src="siteFooter.logo" class="h-12 object-contain rounded border border-gray-200 bg-gray-700 p-1" />
                                <button @click="siteFooter.logo = ''" class="absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                    <XMarkIcon class="w-3 h-3" aria-hidden="true" />
                                </button>
                            </div>
                            <button
                                @click="openMediaLibrary('footer', 'logo')"
                                class="w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-400 hover:text-blue-600 transition-colors"
                            >
                                <PhotoIcon class="w-5 h-5" aria-hidden="true" />
                                <span class="text-sm">{{ siteFooter.logo ? 'Change Logo' : 'Upload Logo' }}</span>
                            </button>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Copyright Text</label>
                            <input
                                v-model="siteFooter.copyrightText"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                placeholder="© 2025 Your Company"
                            />
                        </div>

                        <!-- Footer Columns -->
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-medium text-gray-700">Footer Columns</h4>
                                <button @click="addFooterColumn" class="text-xs text-blue-600 hover:text-blue-700">+ Add Column</button>
                            </div>
                            <div class="space-y-3">
                                <div v-for="(column, colIdx) in siteFooter.columns" :key="column.id" class="p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <input
                                            v-model="column.title"
                                            placeholder="Column Title"
                                            class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                        />
                                        <button @click="removeFooterColumn(colIdx)" class="p-1 hover:bg-red-100 rounded">
                                            <TrashIcon class="w-4 h-4 text-red-500" aria-hidden="true" />
                                        </button>
                                    </div>
                                    <div class="space-y-2 ml-2">
                                        <div v-for="(link, linkIdx) in column.links" :key="link.id" class="flex items-center gap-2">
                                            <input
                                                v-model="link.label"
                                                placeholder="Label"
                                                class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs text-gray-900"
                                            />
                                            <input
                                                v-model="link.url"
                                                placeholder="URL"
                                                class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs text-gray-900"
                                            />
                                            <button @click="removeFooterLink(colIdx, linkIdx)" class="p-0.5 hover:bg-red-100 rounded">
                                                <XMarkIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                            </button>
                                        </div>
                                        <button @click="addFooterLink(colIdx)" class="text-xs text-blue-600 hover:text-blue-700">+ Add Link</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Links -->
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex items-center gap-2 mb-3">
                                <input v-model="siteFooter.showSocialLinks" type="checkbox" id="showSocial" class="rounded border-gray-300" />
                                <label for="showSocial" class="text-sm font-medium text-gray-700">Show Social Links</label>
                            </div>
                            <div v-if="siteFooter.showSocialLinks" class="space-y-2">
                                <div v-for="(social, idx) in siteFooter.socialLinks" :key="social.id" class="flex items-center gap-2">
                                    <select
                                        v-model="social.platform"
                                        class="px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                    >
                                        <option v-for="platform in socialPlatforms" :key="platform.value" :value="platform.value">{{ platform.label }}</option>
                                    </select>
                                    <input
                                        v-model="social.url"
                                        placeholder="Profile URL"
                                        class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"
                                    />
                                    <button @click="removeSocialLink(idx)" class="p-1 hover:bg-red-100 rounded">
                                        <TrashIcon class="w-4 h-4 text-red-500" aria-hidden="true" />
                                    </button>
                                </div>
                                <button @click="addSocialLink" class="text-xs text-blue-600 hover:text-blue-700">+ Add Social Link</button>
                            </div>
                        </div>

                        <!-- Footer Colors -->
                        <div class="border-t border-gray-200 pt-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Footer Colors</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Background Color</label>
                                    <div class="flex items-center gap-2">
                                        <input
                                            type="color"
                                            v-model="siteFooter.backgroundColor"
                                            class="w-10 h-10 rounded cursor-pointer"
                                        />
                                        <input
                                            v-model="siteFooter.backgroundColor"
                                            class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm font-mono text-gray-900"
                                        />
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Text Color</label>
                                    <div class="flex items-center gap-2">
                                        <input
                                            type="color"
                                            v-model="siteFooter.textColor"
                                            class="w-10 h-10 rounded cursor-pointer"
                                        />
                                        <input
                                            v-model="siteFooter.textColor"
                                            class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm font-mono text-gray-900"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Inspector Tabs (for sections) -->
                    <div v-else-if="selectedSection" class="flex border-b border-gray-200">
                        <button
                            @click="activeInspectorTab = 'content'"
                            :class="['flex-1 py-2.5 text-sm font-medium transition-colors border-b-2', activeInspectorTab === 'content' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700']"
                        >
                            Content
                        </button>
                        <button
                            @click="activeInspectorTab = 'style'"
                            :class="['flex-1 py-2.5 text-sm font-medium transition-colors border-b-2', activeInspectorTab === 'style' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700']"
                        >
                            Style
                        </button>
                        <button
                            @click="activeInspectorTab = 'advanced'"
                            :class="['flex-1 py-2.5 text-sm font-medium transition-colors border-b-2', activeInspectorTab === 'advanced' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-gray-700']"
                        >
                            Advanced
                        </button>
                    </div>

                    <!-- Inspector Content -->
                    <div v-if="selectedSection" class="flex-1 overflow-y-auto p-4">
                        <!-- Content Tab -->
                        <div v-if="activeInspectorTab === 'content'" class="space-y-4">
                            <!-- Hero Section Content -->
                            <template v-if="selectedSection.type === 'hero'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Subtitle</label>
                                    <textarea
                                        :value="selectedSection.content.subtitle"
                                        @input="updateSectionContent('subtitle', ($event.target as HTMLTextAreaElement).value)"
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    ></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Background Image</label>
                                    <div v-if="selectedSection.content.backgroundImage" class="relative mb-2">
                                        <img :src="selectedSection.content.backgroundImage" class="w-full h-24 object-cover rounded-lg" />
                                        <button @click="updateSectionContent('backgroundImage', '')" class="absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                            <XMarkIcon class="w-4 h-4" aria-hidden="true" />
                                        </button>
                                    </div>
                                    <button
                                        @click="openMediaLibrary('section', selectedSection.id, 'backgroundImage')"
                                        class="w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-400 hover:text-blue-600 transition-colors"
                                    >
                                        <PhotoIcon class="w-5 h-5" aria-hidden="true" />
                                        <span class="text-sm">{{ selectedSection.content.backgroundImage ? 'Change Background' : 'Add Background' }}</span>
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Text Position</label>
                                    <select
                                        :value="selectedSection.content.textPosition || 'center'"
                                        @change="updateSectionContent('textPosition', ($event.target as HTMLSelectElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    >
                                        <option value="left">Left</option>
                                        <option value="center">Center</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Button Text</label>
                                    <input
                                        :value="selectedSection.content.buttonText"
                                        @input="updateSectionContent('buttonText', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Button Link</label>
                                    <input
                                        :value="selectedSection.content.buttonLink"
                                        @input="updateSectionContent('buttonLink', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                        placeholder="#contact"
                                    />
                                </div>
                            </template>

                            <!-- Page Header Section Content (for inner pages) -->
                            <template v-else-if="selectedSection.type === 'page-header'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                        placeholder="About Us"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Subtitle (optional)</label>
                                    <textarea
                                        :value="selectedSection.content.subtitle"
                                        @input="updateSectionContent('subtitle', ($event.target as HTMLTextAreaElement).value)"
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                        placeholder="A brief description of this page"
                                    ></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Background Image</label>
                                    <div v-if="selectedSection.content.backgroundImage" class="relative mb-2">
                                        <img :src="selectedSection.content.backgroundImage" class="w-full h-24 object-cover rounded-lg" />
                                        <button @click="updateSectionContent('backgroundImage', '')" class="absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                            <XMarkIcon class="w-4 h-4" aria-hidden="true" />
                                        </button>
                                    </div>
                                    <button
                                        @click="openMediaLibrary('section', selectedSection.id, 'backgroundImage')"
                                        class="w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-400 hover:text-blue-600 transition-colors"
                                    >
                                        <PhotoIcon class="w-5 h-5" aria-hidden="true" />
                                        <span class="text-sm">{{ selectedSection.content.backgroundImage ? 'Change Background' : 'Add Background' }}</span>
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Text Position</label>
                                    <select
                                        :value="selectedSection.content.textPosition || 'center'"
                                        @change="updateSectionContent('textPosition', ($event.target as HTMLSelectElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    >
                                        <option value="left">Left</option>
                                        <option value="center">Center</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                                <div class="border-t border-gray-200 pt-4">
                                    <h4 class="text-sm font-medium text-gray-700 mb-3">Colors</h4>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-xs text-gray-500 mb-1">Background Color</label>
                                            <div class="flex items-center gap-2">
                                                <input
                                                    type="color"
                                                    :value="selectedSection.content.backgroundColor || '#1e40af'"
                                                    @input="updateSectionContent('backgroundColor', ($event.target as HTMLInputElement).value)"
                                                    class="w-10 h-10 rounded cursor-pointer"
                                                />
                                                <input
                                                    :value="selectedSection.content.backgroundColor || '#1e40af'"
                                                    @input="updateSectionContent('backgroundColor', ($event.target as HTMLInputElement).value)"
                                                    class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm font-mono text-gray-900"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-500 mb-1">Text Color</label>
                                            <div class="flex items-center gap-2">
                                                <input
                                                    type="color"
                                                    :value="selectedSection.content.textColor || '#ffffff'"
                                                    @input="updateSectionContent('textColor', ($event.target as HTMLInputElement).value)"
                                                    class="w-10 h-10 rounded cursor-pointer"
                                                />
                                                <input
                                                    :value="selectedSection.content.textColor || '#ffffff'"
                                                    @input="updateSectionContent('textColor', ($event.target as HTMLInputElement).value)"
                                                    class="flex-1 px-2 py-1.5 border border-gray-300 rounded text-sm font-mono text-gray-900"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- About Section Content -->
                            <template v-else-if="selectedSection.type === 'about'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea
                                        :value="selectedSection.content.description"
                                        @input="updateSectionContent('description', ($event.target as HTMLTextAreaElement).value)"
                                        rows="4"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    ></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Image</label>
                                    <div v-if="selectedSection.content.image" class="relative mb-2">
                                        <img :src="selectedSection.content.image" class="w-full h-32 object-cover rounded-lg" />
                                        <button @click="updateSectionContent('image', '')" class="absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                            <XMarkIcon class="w-4 h-4" aria-hidden="true" />
                                        </button>
                                    </div>
                                    <button
                                        @click="openMediaLibrary('section', selectedSection.id, 'image')"
                                        class="w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-400 hover:text-blue-600 transition-colors"
                                    >
                                        <PhotoIcon class="w-5 h-5" aria-hidden="true" />
                                        <span class="text-sm">{{ selectedSection.content.image ? 'Change Image' : 'Add Image' }}</span>
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Image Position</label>
                                    <select
                                        :value="selectedSection.content.imagePosition || 'right'"
                                        @change="updateSectionContent('imagePosition', ($event.target as HTMLSelectElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    >
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                            </template>

                            <!-- Services/Features Section Content -->
                            <template v-else-if="selectedSection.type === 'services' || selectedSection.type === 'features'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Items</label>
                                        <button @click="addItem" class="text-xs text-blue-600 hover:text-blue-700">+ Add Item</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(item, idx) in selectedSection.content.items || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Item {{ idx + 1 }}</span>
                                                <button @click="removeItem(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="item.title" placeholder="Title" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <textarea v-model="item.description" placeholder="Description" rows="2" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Testimonials Section Content -->
                            <template v-else-if="selectedSection.type === 'testimonials'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Testimonials</label>
                                        <button @click="addItem" class="text-xs text-blue-600 hover:text-blue-700">+ Add</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(item, idx) in selectedSection.content.items || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Testimonial {{ idx + 1 }}</span>
                                                <button @click="removeItem(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="item.name" placeholder="Name" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <input v-model="item.role" placeholder="Role" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <textarea v-model="item.text" placeholder="Testimonial" rows="2" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Pricing Section Content -->
                            <template v-else-if="selectedSection.type === 'pricing'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Plans</label>
                                        <button @click="addPlan" class="text-xs text-blue-600 hover:text-blue-700">+ Add Plan</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(plan, idx) in selectedSection.content.plans || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Plan {{ idx + 1 }}</span>
                                                <button @click="removePlan(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="plan.name" placeholder="Plan Name" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <input v-model="plan.price" placeholder="Price (e.g., K99)" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <div class="mt-2">
                                                <div class="flex items-center justify-between mb-1">
                                                    <span class="text-xs text-gray-500">Features</span>
                                                    <button @click="addPlanFeature(idx)" class="text-xs text-blue-600">+ Add</button>
                                                </div>
                                                <div v-for="(feature, fIdx) in plan.features || []" :key="fIdx" class="flex items-center gap-1 mb-1">
                                                    <input v-model="plan.features[fIdx]" class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs text-gray-900" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Gallery Section Content -->
                            <template v-else-if="selectedSection.type === 'gallery'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Images</label>
                                        <button @click="openMediaLibrary('section', selectedSection.id, 'images')" class="text-xs text-blue-600 hover:text-blue-700">+ Add Image</button>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2">
                                        <div v-for="(img, idx) in selectedSection.content.images || []" :key="img.id || idx" class="relative aspect-square">
                                            <img :src="img.url" class="w-full h-full object-cover rounded-lg" />
                                            <button @click="removeGalleryImage(selectedSection.id, idx)" class="absolute top-1 right-1 p-0.5 bg-red-500 text-white rounded-full hover:bg-red-600">
                                                <XMarkIcon class="w-3 h-3" aria-hidden="true" />
                                            </button>
                                        </div>
                                    </div>
                                    <div v-if="!selectedSection.content.images?.length" class="text-center py-6 text-gray-400 border-2 border-dashed border-gray-200 rounded-lg">
                                        <PhotoIcon class="w-8 h-8 mx-auto mb-2" aria-hidden="true" />
                                        <p class="text-xs">No images yet</p>
                                    </div>
                                </div>
                            </template>

                            <!-- Contact Section Content -->
                            <template v-else-if="selectedSection.type === 'contact'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea
                                        :value="selectedSection.content.description"
                                        @input="updateSectionContent('description', ($event.target as HTMLTextAreaElement).value)"
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    ></textarea>
                                </div>
                            </template>

                            <!-- CTA Section Content -->
                            <template v-else-if="selectedSection.type === 'cta'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea
                                        :value="selectedSection.content.description"
                                        @input="updateSectionContent('description', ($event.target as HTMLTextAreaElement).value)"
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    ></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Button Text</label>
                                    <input
                                        :value="selectedSection.content.buttonText"
                                        @input="updateSectionContent('buttonText', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                            </template>

                            <!-- Text Section Content -->
                            <template v-else-if="selectedSection.type === 'text'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                                    <textarea
                                        :value="selectedSection.content.content"
                                        @input="updateSectionContent('content', ($event.target as HTMLTextAreaElement).value)"
                                        rows="8"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono text-gray-900"
                                        placeholder="<p>Your HTML content here...</p>"
                                    ></textarea>
                                </div>
                            </template>

                            <!-- FAQ Section Content -->
                            <template v-else-if="selectedSection.type === 'faq'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Questions</label>
                                        <button @click="addFaqItem" class="text-xs text-blue-600 hover:text-blue-700">+ Add Question</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(item, idx) in selectedSection.content.items || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Q{{ idx + 1 }}</span>
                                                <button @click="removeFaqItem(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="item.question" placeholder="Question" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <textarea v-model="item.answer" placeholder="Answer" rows="2" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Team Section Content -->
                            <template v-else-if="selectedSection.type === 'team'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Team Members</label>
                                        <button @click="addTeamMember" class="text-xs text-blue-600 hover:text-blue-700">+ Add Member</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(member, idx) in selectedSection.content.items || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Member {{ idx + 1 }}</span>
                                                <button @click="removeTeamMember(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="member.name" placeholder="Name" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <input v-model="member.role" placeholder="Role/Position" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <textarea v-model="member.bio" placeholder="Short bio" rows="2" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Blog Section Content -->
                            <template v-else-if="selectedSection.type === 'blog'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Blog Posts</label>
                                        <button @click="addBlogPost" class="text-xs text-blue-600 hover:text-blue-700">+ Add Post</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(post, idx) in selectedSection.content.posts || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Post {{ idx + 1 }}</span>
                                                <button @click="removeBlogPost(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="post.title" placeholder="Post Title" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <input v-model="post.date" type="date" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <textarea v-model="post.excerpt" placeholder="Excerpt" rows="2" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Stats Section Content -->
                            <template v-else-if="selectedSection.type === 'stats'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title (optional)</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm font-medium text-gray-700">Stats</label>
                                        <button @click="addStatItem" class="text-xs text-blue-600 hover:text-blue-700">+ Add Stat</button>
                                    </div>
                                    <div class="space-y-3">
                                        <div v-for="(stat, idx) in selectedSection.content.items || []" :key="idx" class="p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs font-medium text-gray-500">Stat {{ idx + 1 }}</span>
                                                <button @click="removeStatItem(idx)" class="p-1 hover:bg-red-100 rounded">
                                                    <TrashIcon class="w-3.5 h-3.5 text-red-500" aria-hidden="true" />
                                                </button>
                                            </div>
                                            <input v-model="stat.value" placeholder="Value (e.g., 500+)" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm mb-2 text-gray-900" />
                                            <input v-model="stat.label" placeholder="Label (e.g., Happy Clients)" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm text-gray-900" />
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Map Section Content -->
                            <template v-else-if="selectedSection.type === 'map'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Google Maps Embed URL</label>
                                    <input
                                        :value="selectedSection.content.embedUrl"
                                        @input="updateSectionContent('embedUrl', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                        placeholder="https://www.google.com/maps/embed?..."
                                    />
                                    <p class="text-xs text-gray-500 mt-1">Get embed URL from Google Maps → Share → Embed</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                    <input
                                        :value="selectedSection.content.address"
                                        @input="updateSectionContent('address', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div class="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        :checked="selectedSection.content.showAddress"
                                        @change="updateSectionContent('showAddress', ($event.target as HTMLInputElement).checked)"
                                        class="rounded border-gray-300"
                                    />
                                    <label class="text-sm text-gray-700">Show address below map</label>
                                </div>
                            </template>

                            <!-- Video Section Content -->
                            <template v-else-if="selectedSection.type === 'video'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Section Title</label>
                                    <input
                                        :value="selectedSection.content.title"
                                        @input="updateSectionContent('title', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea
                                        :value="selectedSection.content.description"
                                        @input="updateSectionContent('description', ($event.target as HTMLTextAreaElement).value)"
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    ></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Video URL</label>
                                    <input
                                        :value="selectedSection.content.videoUrl"
                                        @input="updateSectionContent('videoUrl', ($event.target as HTMLInputElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                        placeholder="YouTube or Vimeo embed URL"
                                    />
                                    <p class="text-xs text-gray-500 mt-1">Use embed URL (e.g., https://www.youtube.com/embed/VIDEO_ID)</p>
                                </div>
                            </template>

                            <!-- Divider Section Content -->
                            <template v-else-if="selectedSection.type === 'divider'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Style</label>
                                    <select
                                        :value="selectedSection.content.style || 'line'"
                                        @change="updateSectionContent('style', ($event.target as HTMLSelectElement).value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    >
                                        <option value="line">Line</option>
                                        <option value="dots">Dots</option>
                                        <option value="space">Space Only</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Height (px)</label>
                                    <input
                                        type="number"
                                        :value="selectedSection.content.height || 40"
                                        @input="updateSectionContent('height', parseInt(($event.target as HTMLInputElement).value) || 40)"
                                        min="10"
                                        max="200"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-900"
                                    />
                                </div>
                                <div v-if="selectedSection.content.style !== 'space'">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                    <input
                                        type="color"
                                        :value="selectedSection.content.color || '#e5e7eb'"
                                        @input="updateSectionContent('color', ($event.target as HTMLInputElement).value)"
                                        class="w-full h-10 rounded-lg cursor-pointer"
                                    />
                                </div>
                            </template>
                        </div>

                        <!-- Style Tab -->
                        <div v-if="activeInspectorTab === 'style'" class="space-y-4">
                            <!-- Section Height -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Section Height</label>
                                <div class="flex items-center gap-3">
                                    <input
                                        type="range"
                                        :value="selectedSection.style?.minHeight || 200"
                                        @input="updateSectionStyle('minHeight', parseInt(($event.target as HTMLInputElement).value))"
                                        min="100"
                                        max="800"
                                        step="10"
                                        class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                    />
                                    <div class="flex items-center gap-1">
                                        <input
                                            type="number"
                                            :value="selectedSection.style?.minHeight || 200"
                                            @input="updateSectionStyle('minHeight', parseInt(($event.target as HTMLInputElement).value) || 200)"
                                            min="100"
                                            max="800"
                                            class="w-16 px-2 py-1 border border-gray-300 rounded text-sm text-center text-gray-900"
                                        />
                                        <span class="text-xs text-gray-500">px</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-400 mt-1">Drag the bottom edge of a section to resize, or use the slider</p>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Background Color</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <button
                                        v-for="color in themeColors"
                                        :key="color.value"
                                        @click="updateSectionStyle('backgroundColor', color.value)"
                                        :class="['w-full aspect-square rounded-lg border-2 transition-all', selectedSection.style?.backgroundColor === color.value ? 'border-blue-500 ring-2 ring-blue-200' : 'border-gray-200 hover:border-gray-300']"
                                        :style="{ backgroundColor: color.value }"
                                        :title="color.name"
                                    ></button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Custom Background</label>
                                <input
                                    type="color"
                                    :value="selectedSection.style?.backgroundColor || '#ffffff'"
                                    @input="updateSectionStyle('backgroundColor', ($event.target as HTMLInputElement).value)"
                                    class="w-full h-10 rounded-lg cursor-pointer"
                                />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Text Color</label>
                                <input
                                    type="color"
                                    :value="selectedSection.style?.textColor || '#111827'"
                                    @input="updateSectionStyle('textColor', ($event.target as HTMLInputElement).value)"
                                    class="w-full h-10 rounded-lg cursor-pointer"
                                />
                            </div>
                        </div>

                        <!-- Advanced Tab -->
                        <div v-if="activeInspectorTab === 'advanced'" class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-500">Section ID: <code class="text-xs bg-gray-200 px-1 rounded">{{ selectedSection.id }}</code></p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">CSS Class</label>
                                <input
                                    :value="selectedSection.style?.cssClass || ''"
                                    @input="updateSectionStyle('cssClass', ($event.target as HTMLInputElement).value)"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono text-gray-900"
                                    placeholder="custom-class"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Toggle Right Sidebar -->
            <button
                @click="rightSidebarOpen = !rightSidebarOpen"
                class="absolute right-0 top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white border border-gray-200 rounded-l-lg shadow-sm hover:bg-gray-50 transition-colors"
                :class="rightSidebarOpen ? 'mr-80' : 'mr-0'"
                aria-label="Toggle right sidebar"
            >
                <ChevronRightIcon :class="['w-4 h-4 text-gray-500 transition-transform', rightSidebarOpen ? '' : 'rotate-180']" aria-hidden="true" />
            </button>
        </div>
    </div>

    <!-- Create Page Modal -->
    <Teleport to="body">
        <div v-if="showCreatePageModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" @click="showCreatePageModal = false">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[85vh] overflow-hidden flex flex-col" @click.stop>
                <!-- Modal Header -->
                <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <button
                            v-if="createPageStep === 'details'"
                            @click="backToTemplates"
                            class="p-1 hover:bg-gray-100 rounded-lg"
                        >
                            <ChevronLeftIcon class="w-5 h-5 text-gray-500" aria-hidden="true" />
                        </button>
                        <h2 class="text-lg font-semibold text-gray-900">
                            {{ createPageStep === 'template' ? 'Choose a Template' : 'Page Details' }}
                        </h2>
                    </div>
                    <button @click="showCreatePageModal = false" class="p-1 hover:bg-gray-100 rounded-lg">
                        <XMarkIcon class="w-5 h-5 text-gray-500" aria-hidden="true" />
                    </button>
                </div>

                <!-- Step 1: Template Selection -->
                <div v-if="createPageStep === 'template'" class="flex-1 overflow-y-auto p-4">
                    <p class="text-sm text-gray-600 mb-4">Select a pre-designed template or start from scratch</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <button
                            v-for="template in newPageTemplates"
                            :key="template.id"
                            @click="selectTemplate(template.id)"
                            :class="[
                                'p-4 border-2 rounded-xl text-left transition-all hover:border-blue-400 hover:bg-blue-50/50',
                                newPageForm.templateId === template.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200',
                            ]"
                        >
                            <component :is="getTemplateIcon(template.iconType)" class="w-6 h-6 text-gray-500 mb-2" aria-hidden="true" />
                            <h3 class="font-medium text-gray-900 text-sm">{{ template.name }}</h3>
                            <p class="text-xs text-gray-500 mt-1">{{ template.description }}</p>
                            <p class="text-xs text-gray-400 mt-2">
                                {{ template.sections.length === 0 ? 'Empty' : `${template.sections.length} sections` }}
                            </p>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Page Details -->
                <div v-else class="flex-1 overflow-y-auto p-4">
                    <!-- Selected Template Preview -->
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg flex items-center gap-3">
                        <component :is="getTemplateIcon(pageTemplates.find(t => t.id === newPageForm.templateId)?.iconType || 'document')" class="w-6 h-6 text-gray-500" aria-hidden="true" />
                        <div>
                            <p class="font-medium text-gray-900 text-sm">{{ pageTemplates.find(t => t.id === newPageForm.templateId)?.name }}</p>
                            <p class="text-xs text-gray-500">{{ pageTemplates.find(t => t.id === newPageForm.templateId)?.sections.length || 0 }} pre-built sections</p>
                        </div>
                    </div>

                    <!-- Error Message -->
                    <div v-if="pageError" class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                        {{ pageError }}
                    </div>

                    <form @submit.prevent="createPage" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Page Title</label>
                            <input
                                v-model="newPageForm.title"
                                type="text"
                                required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900"
                                placeholder="e.g., About Us"
                                :disabled="creatingPage"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">URL Slug</label>
                            <input
                                v-model="newPageForm.slug"
                                type="text"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900"
                                placeholder="about-us"
                                :disabled="creatingPage"
                            />
                            <p class="text-xs text-gray-500 mt-1">This will be the URL path: /{{ newPageForm.slug || 'page-slug' }}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <input v-model="newPageForm.showInNav" type="checkbox" id="showInNav" class="rounded border-gray-300" :disabled="creatingPage" />
                            <label for="showInNav" class="text-sm text-gray-700">Show in navigation menu</label>
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button type="button" @click="backToTemplates" :disabled="creatingPage" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50">
                                Back
                            </button>
                            <button type="submit" :disabled="creatingPage" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                                {{ creatingPage ? 'Creating...' : 'Create Page' }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </Teleport>

    <!-- Edit Page Modal -->
    <Teleport to="body">
        <div v-if="showEditPageModal && editingPage" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6" @click.stop>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Edit Page</h2>
                <form @submit.prevent="updatePage" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Page Title</label>
                        <input
                            v-model="editingPage.title"
                            type="text"
                            required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">URL Slug</label>
                        <input
                            v-model="editingPage.slug"
                            type="text"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-900"
                            :disabled="editingPage.isHomepage"
                        />
                    </div>
                    <div class="flex items-center gap-2">
                        <input v-model="editingPage.showInNav" type="checkbox" id="editShowInNav" class="rounded border-gray-300" />
                        <label for="editShowInNav" class="text-sm text-gray-700">Show in navigation</label>
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" @click="showEditPageModal = false; editingPage = null" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </Teleport>

    <!-- Apply Template Modal -->
    <Teleport to="body">
        <div v-if="showApplyTemplateModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" @click="showApplyTemplateModal = false">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[85vh] overflow-hidden flex flex-col" @click.stop>
                <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Apply Template</h2>
                        <p class="text-sm text-gray-500">Replace current page content with a template</p>
                    </div>
                    <button @click="showApplyTemplateModal = false" class="p-1 hover:bg-gray-100 rounded-lg">
                        <XMarkIcon class="w-5 h-5 text-gray-500" aria-hidden="true" />
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-4">
                    <!-- Warning -->
                    <div class="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                        <p class="text-sm text-amber-800">
                            <strong>Warning:</strong> This will replace all existing sections on "{{ activePage?.title }}". This action cannot be undone.
                        </p>
                    </div>

                    <!-- Template Categories -->
                    <div v-if="activePage?.isHomepage" class="mb-4">
                        <p class="text-sm font-medium text-gray-700 mb-2">Home Page Templates</p>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
                            <button
                                v-for="template in pageTemplates.filter(t => t.isHomepage)"
                                :key="template.id"
                                @click.stop.prevent="applyTemplate(template.id)"
                                :disabled="applyingTemplate"
                                type="button"
                                class="p-4 border-2 border-gray-200 rounded-xl text-left transition-all hover:border-blue-400 hover:bg-blue-50/50 disabled:opacity-50"
                            >
                                <component :is="getTemplateIcon(template.iconType)" class="w-6 h-6 text-gray-500 mb-2 pointer-events-none" aria-hidden="true" />
                                <h3 class="font-medium text-gray-900 text-sm pointer-events-none">{{ template.name }}</h3>
                                <p class="text-xs text-gray-500 mt-1 pointer-events-none">{{ template.description }}</p>
                                <p class="text-xs text-gray-400 mt-2 pointer-events-none">{{ template.sections.length }} sections</p>
                            </button>
                        </div>
                    </div>

                    <p class="text-sm font-medium text-gray-700 mb-2">{{ activePage?.isHomepage ? 'Other Templates' : 'Page Templates' }}</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <button
                            v-for="template in pageTemplates.filter(t => !t.isHomepage)"
                            :key="template.id"
                            @click.stop.prevent="applyTemplate(template.id)"
                            :disabled="applyingTemplate"
                            type="button"
                            class="p-4 border-2 border-gray-200 rounded-xl text-left transition-all hover:border-blue-400 hover:bg-blue-50/50 disabled:opacity-50"
                        >
                            <component :is="getTemplateIcon(template.iconType)" class="w-6 h-6 text-gray-500 mb-2 pointer-events-none" aria-hidden="true" />
                            <h3 class="font-medium text-gray-900 text-sm pointer-events-none">{{ template.name }}</h3>
                            <p class="text-xs text-gray-500 mt-1 pointer-events-none">{{ template.description }}</p>
                            <p class="text-xs text-gray-400 mt-2 pointer-events-none">
                                {{ template.sections.length === 0 ? 'Empty' : `${template.sections.length} sections` }}
                            </p>
                        </button>
                    </div>
                </div>

                <div class="p-4 border-t border-gray-200 bg-gray-50">
                    <button
                        @click="showApplyTemplateModal = false"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </Teleport>

    <!-- Media Library Modal -->
    <Teleport to="body">
        <div v-if="showMediaLibrary" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" @click="showMediaLibrary = false">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl max-h-[80vh] flex flex-col" @click.stop>
                <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">Media Library</h2>
                    <button @click="showMediaLibrary = false" class="p-1 hover:bg-gray-100 rounded-lg">
                        <XMarkIcon class="w-5 h-5 text-gray-500" aria-hidden="true" />
                    </button>
                </div>
                
                <!-- Upload Section -->
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <label class="flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50/50 transition-colors">
                        <div class="flex flex-col items-center justify-center">
                            <PhotoIcon class="w-8 h-8 text-gray-400 mb-1" aria-hidden="true" />
                            <p class="text-sm text-gray-500">
                                <span v-if="uploadingImage">Uploading...</span>
                                <span v-else>Click to upload or drag and drop</span>
                            </p>
                            <p class="text-xs text-gray-400">PNG, JPG, GIF, WebP up to 5MB</p>
                        </div>
                        <input type="file" class="hidden" accept="image/*" @change="uploadImage" :disabled="uploadingImage" />
                    </label>
                    <p v-if="imageUploadError" class="mt-2 text-sm text-red-600">{{ imageUploadError }}</p>
                </div>

                <!-- Media Grid -->
                <div class="flex-1 overflow-y-auto p-4">
                    <div v-if="mediaLibrary.length > 0" class="grid grid-cols-4 gap-3">
                        <button
                            v-for="media in mediaLibrary"
                            :key="media.id"
                            @click="selectMediaImage(media)"
                            class="aspect-square rounded-lg overflow-hidden border-2 border-transparent hover:border-blue-500 focus:border-blue-500 focus:outline-none transition-colors"
                        >
                            <img :src="media.thumbnailUrl || media.url" :alt="media.originalName" class="w-full h-full object-cover" />
                        </button>
                    </div>
                    <div v-else class="text-center py-12 text-gray-400">
                        <PhotoIcon class="w-12 h-12 mx-auto mb-3" aria-hidden="true" />
                        <p>No images uploaded yet</p>
                        <p class="text-sm">Upload your first image above</p>
                    </div>
                </div>
            </div>
        </div>
    </Teleport>
</template>
